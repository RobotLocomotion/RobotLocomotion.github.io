<!-- HTML header for doxygen 1.8.15-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Drake: Hydroelastic Contact User Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_extra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Drake
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
   <td>
    <div id="DDGSearch">
     <form id="ddg-search-form" class="wy_form" action="https://duckduckgo.com/" method="get">
      <input type="text" name="q" placeholder="Search C++ API only…" />
      <input type="hidden" name="sites" value="drake.mit.edu/doxygen_cxx" />
     </form>
     <form id="ddg-search-form" class="wy_form" action="https://duckduckgo.com/" method="get">
      <input type="text" name="q" placeholder="Search all of Drake…" />
      <input type="hidden" name="sites" value="drake.mit.edu" />
     </form>
    </div">
   </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('group__hydroelastic__user__guide.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Hydroelastic Contact User Guide<div class="ingroups"><a class="el" href="group__multibody.html">Multibody Kinematics and Dynamics</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<h1><a class="anchor" id="hug_title"></a>
Hydroelastic Contact User Guide</h1>
<h2><a class="anchor" id="hug_introduction"></a>
Introduction</h2>
<p>There are many ways to model contact between rigid bodies. Drake uses an approach we call “compliant” contact. In compliant contact, nominally rigid bodies are allowed to penetrate slightly, as if the rigid body had a slightly deformable layer, but whose compression has no appreciable effect on the body’s mass properties. The contact force between two deformed bodies is distributed over a contact patch with an uneven pressure distribution over that patch. It is common in robotics to model that as a single point contact or a set of point contacts. Hydroelastic contact instead attempts to approximate the patch and pressure distribution to provide much richer and more realistic contact behavior.</p>
<p>Drake implements two models for resolving contact to forces: point contact and hydroelastic contact. See <a class="el" href="group__hydroelastic__user__guide.html#hydro_appendix_a">Appendix A: Compliant Contact Models</a> for a fuller discussion of the theory and practice of contact models. For notes on implementation status, see <a class="el" href="group__hydroelastic__user__guide.html#hydro_appendix_b">Appendix B: Current state of implementation</a>.</p>
<h2><a class="anchor" id="hug_working_with_hydro"></a>
Working with Hydroelastic Contact</h2>
<p>It is relatively simple to enable a simulation to use hydroelastic contact. However, using it effectively requires some experience and consideration. This section details the mechanisms and choices involved in enabling hydroelastic contact and the next section helps guide you through some common tips, tricks, and traps.</p>
<p>Using hydroelastic contact requires two things:</p><ul>
<li>Configuring the system (<a class="el" href="classdrake_1_1multibody_1_1_multibody_plant.html" title="MultibodyPlant is a Drake system framework representation (see systems::System) for the model of a ph...">drake::multibody::MultibodyPlant</a>) to use hydroelastic contact.</li>
<li>Applying appropriate properties to the collision geometries to enable hydroelastic contact calculations.</li>
</ul>
<h3><a class="anchor" id="hug_enabling"></a>
Enabling Hydroelastic contact in your simulation</h3>
<p>Because <a class="el" href="classdrake_1_1multibody_1_1_multibody_plant.html">MultibodyPlant</a> is responsible for computing the dynamics of the system (and the contact forces are part of that), the ability to enable/disable the hydroelastic contact model is part of <code>MultibodyPlant</code>’s API: <a class="el" href="classdrake_1_1multibody_1_1_multibody_plant.html#ad253ab790ff8e142080cedd210e982da" title="Sets the contact model to be used by this MultibodyPlant, see ContactModel for available options.">drake::multibody::MultibodyPlant::set_contact_model()</a>.</p>
<p>There are three different options:</p><ul>
<li><a class="el" href="namespacedrake_1_1multibody.html#a6f6e054758d34b83e86bea87d65dfe4ea20e722b15a1b587c30633f0a136b7009" title="Contact forces are computed using a point contact model, see Numerical Approximation of Point Contact...">drake::multibody::ContactModel::kPoint</a></li>
<li><a class="el" href="namespacedrake_1_1multibody.html#a6f6e054758d34b83e86bea87d65dfe4ea873aefb0d70a0478c541b2d98484595d" title="Contact forces are computed using the Hydroelastic model.">drake::multibody::ContactModel::kHydroelastic</a></li>
<li><a class="el" href="namespacedrake_1_1multibody.html#a6f6e054758d34b83e86bea87d65dfe4ea8ad3adce463edb0d2843e1f1c0057d4a" title="Contact forces are computed using the hydroelastic model, where possible.">drake::multibody::ContactModel::kHydroelasticWithFallback</a></li>
</ul>
<p>The default model is <a class="el" href="namespacedrake_1_1multibody.html#a6f6e054758d34b83e86bea87d65dfe4ea8ad3adce463edb0d2843e1f1c0057d4a">kHydroelasticWithFallback</a>.</p>
<p><a class="el" href="namespacedrake_1_1multibody.html#a6f6e054758d34b83e86bea87d65dfe4ea20e722b15a1b587c30633f0a136b7009">kPoint</a> is the implementation of the point contact model (see <a class="el" href="group__hydroelastic__user__guide.html#hydro_appendix_a">Appendix A: Compliant Contact Models</a>).</p>
<p>Models <a class="el" href="namespacedrake_1_1multibody.html#a6f6e054758d34b83e86bea87d65dfe4ea873aefb0d70a0478c541b2d98484595d">kHydroelastic</a> and <a class="el" href="namespacedrake_1_1multibody.html#a6f6e054758d34b83e86bea87d65dfe4ea8ad3adce463edb0d2843e1f1c0057d4a">kHydroelasticWithFallback</a> will both enable the hydroelastic contact. For forces to be created from hydroelastic contact, geometries need to have hydroelastic representations (see <a class="el" href="group__hydroelastic__user__guide.html#creating_hydro_reps">Creating hydroelastic representations of collision geometries</a>).</p>
<p><a class="el" href="namespacedrake_1_1multibody.html#a6f6e054758d34b83e86bea87d65dfe4ea873aefb0d70a0478c541b2d98484595d">kHydroelastic</a> is a strict contact model that will attempt to create a hydroelastic contact surface whenever a geometry with a hydroelastic representation appears to be in contact (based on broad-phase bounding volume culling). With this contact model, the simulator will throw an exception if:</p>
<ul>
<li>The contact is between two geometries with rigid hydroelastic representation, or</li>
<li>The contact is between a geometry with a hydroelastic representation and one without.</li>
</ul>
<p>Collisions between two geometries where neither has a hydroelastic representation are simply ignored.</p>
<p><a class="el" href="namespacedrake_1_1multibody.html#a6f6e054758d34b83e86bea87d65dfe4ea8ad3adce463edb0d2843e1f1c0057d4a">kHydroelasticWithFallback</a> provides “fallback” behavior for when <a class="el" href="namespacedrake_1_1multibody.html#a6f6e054758d34b83e86bea87d65dfe4ea873aefb0d70a0478c541b2d98484595d">kHydroelastic</a> would throw. When those scenarios are detected, it uses the point contact model between the colliding geometries so that the contact can be accounted for and produce contact forces. As the implementation evolves, more and more contact will be captured with hydroelastic contact and the circumstances in which the point-contact fallback is applied will decrease.</p>
<h3><a class="anchor" id="creating_hydro_reps"></a>
Creating hydroelastic representations of collision geometries</h3>
<p>By default no geometry in <a class="el" href="classdrake_1_1geometry_1_1_scene_graph.html" title="SceneGraph serves as the nexus for all geometry (and geometry-based operations) in a Diagram.">drake::geometry::SceneGraph</a> has a hydroelastic representation. So, enabling hydroelastic contact in <code>MultibodyPlant</code>, but forgetting to configure the geometries will lead to either simulation crashes or point contact-based forces.</p>
<p>In order for a mesh to be given a hydroelastic representation, it must be assigned certain properties. The exact properties it needs depends on the Shape type and whether it is rigid or compliant. Some properties can be defined, but if they are absent they’ll be provided by <code>MultibodyPlant</code>. First we’ll discuss each of the properties and then discuss how they can be specified.</p>
<h4><a class="anchor" id="hug_properties"></a>
Properties for hydroelastic contact</h4>
<ul>
<li>Hydroelastic classification<ul>
<li>To have a hydroelastic representation, a shape needs to be classified as either “compliant” or “rigid”. This must be explicit &ndash; there are no implicit assumptions. Otherwise, it will participate in point contact only.</li>
</ul>
</li>
<li>Resolution hint (meters)<ul>
<li>A positive real value in meters.</li>
<li>Most shapes (capsules, cylinders, ellipsoids, spheres) need to be tessellated into meshes. The resolution hint controls the fineness of the meshes.</li>
<li>For all tessellated geometries, Drake puts hard limits on the effect of the resolution hint property. There is a limit to how fine Drake will tessellate a primitive. Drake has hard-coded internal limits that are still very generous (approximately 100 million tetrahedra or triangles) which should be more than enough for any application. In practice, resolution hints will be quite “large” as coarser meshes are typically more desirable.</li>
<li>Notes on choosing a value:<ul>
<li>Generally, the coarsest mesh that produces desirable results will allow the simulation to run as efficiently as possible.<ul>
<li>The coarsest mesh will typically be generated when the resolution is equal to the geometry’s maximum measure (see the details below).</li>
</ul>
</li>
<li>If tessellation artifacts become obvious in the simulation, either make the object more compliant (see hydroelastic modulus) or increase the resolution (as discussed for the various shapes below).</li>
</ul>
</li>
<li>Geometric detail:<ul>
<li>For each geometry type, the resolution hint works with some (maybe abstract) choice of a representative circle, and its effect is defined in terms of the circumference of that circle. The resolution hint is the target length of each edge of the tessellated mesh around the circle. The circle will have N = ⌈2πr/h⌉ edges, where r is the capsule radius and h is the resolution hint. The number N changes discontinuously as h changes. However, generally, decreasing the resolution hint by some factor will increase the number of edges by that same factor. The number of elements will grow quadratically.<ul>
<li>Sphere<ul>
<li>The representative circle is the great circle of the sphere.</li>
</ul>
</li>
<li>Cylinder<ul>
<li>The representative circle is the base of the cylinder.</li>
</ul>
</li>
<li>Capsule<ul>
<li>The representative circle is the base of the cylinder, which is also the great circle of each hemisphere.</li>
</ul>
</li>
<li>Ellipsoid<ul>
<li>The representative circle is an abstract circle whose radius is that of the largest semi-axis of the elllipsoid.</li>
</ul>
</li>
</ul>
</li>
<li>Resolution hint has no effect on Box.</li>
</ul>
</li>
</ul>
</li>
<li>Hydroelastic modulus (Pa (N/m²))<ul>
<li>This is the measure of how stiff the material is. It directly defines how much pressure is exerted given a certain amount of penetration. More pressure leads to greater forces. Larger values create stiffer objects. An infinite modulus is mathematically equivalent to a “rigid” object. (Although, it is definitely better, in that case, to simply declare it “rigid”.)</li>
<li>This is <em>only</em> required for shapes declared to be “compliant”. It can be defined for shapes declared as “rigid”, but the value will be ignored. (It can be convenient to always define it to enable tests where one might toggle the classification between rigid and compliant such that the compliant declaration is always well formed.)</li>
<li>Declaring a geometry to be compliant but not providing a valid hydroelastic modulus will produce an error at the time the geometry is added to <code>SceneGraph</code>.</li>
<li>This is similar to something like Young’s modulus but it is not identical.<ul>
<li>The primary distinction is this isn’t purely a material property. The value is entangled with the geometry. It essentially scales the force based on the <em>percentage</em> of penetration into an object (i.e., strain). So, a fixed modulus value might lead to a 1cm penetration on one sphere. But if the sphere were scaled up by a factor of 10, the penetration would become 10cm. So, if there are constraints on penetration depth, the modulus would have to increase with the scale of the geometry.</li>
</ul>
</li>
<li>Notes on choosing a value:<ul>
<li>Starting with the value for Young’s modulus is not unreasonable. Empirical evidence suggests that the hydroelastic modulus tends to be smaller depending on the size of the objects.</li>
<li>For large modulus values, the resolution of the representations matter more. A very high modulus will keep the contact near the surface of the geometry, exposing tessellation artifacts. A smaller modulus has a smoothing effect.</li>
</ul>
</li>
</ul>
</li>
<li>Hunt-Crossley dissipation (s/m)<ul>
<li>A non-negative real value.</li>
<li>This gives the contact an energy-damping property.</li>
<li>The larger the value, the more energy is damped.</li>
<li>If no value is provided, <code>MultibodyPlant</code> provides a default value of zero.</li>
<li>Notes on choosing a value:<ul>
<li>For objects that are nominally rigid, starting with zero-damping is good.</li>
<li>If the behavior seems “jittery”, gradually increase the amount of dissipation. Typical values would remain in the range [0, 3] with 1 being a typical damping amount.</li>
<li>Remember, as this value increases, your simulation will lose energy at a higher rate.</li>
</ul>
</li>
<li>See <a class="el" href="classdrake_1_1multibody_1_1_multibody_plant.html#mbp_dissipation_model">Modeling Dissipation</a> for details.</li>
</ul>
</li>
<li>Slab thickness<ul>
<li>A positive real value in meters</li>
<li>Only used for compliant half spaces. Declaring a half space to be compliant but lacking a value for slab thickness will cause the simulation to error out.</li>
<li>A measure of the thickness of the compliant material near the boundary of the half space.<ul>
<li>A compliant half space can be made more rigid by:<ul>
<li>Increasing the hydroelastic modulus and fixing slab thickness.</li>
<li>Fixing the hydroelastic modulus and decreasing the slab thickness.</li>
<li>Increasing the hydroelastic modulus and decreasing the slab thickness.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="hug_geometry_properties"></a>
Assigning hydroelastic properties to geometries</h3>
<p>Properties can be assigned to geometries inside a URDF or SDFormat file using some custom Drake XML tags. Alternatively, the properties can be assigned programmatically.</p>
<h4><a class="anchor" id="hug_file_specs"></a>
Assigning hydroelastic properties in file specifications</h4>
<p>Drake has introduced a number of custom tags to provide a uniform language to specify hydroelastic properties in both URDF and SDFormat. The tag names are the same but the values are expressed differently (to align with the practices common to URDF and SDFormat). For example, consider a custom tag &lt;drake:foo&gt; that takes a single integer value. In an SDFormat file it would look like: </p><pre class="fragment">&lt;drake:foo&gt;17&lt;/drake:foo&gt;
</pre><p>But in a URDF file it would look like this: </p><pre class="fragment">&lt;drake:foo value=”17”/&gt;
</pre><p>Both URDF and SDFormat files define a &lt;collision&gt; tag. This tag contains the tag for specifying the geometry type and associated properties. The hydroelastic properties can be specified as a child of the &lt;collision&gt; tag. Consider the following SDFormat example: </p><pre class="fragment">…
  &lt;collision name="body1_collision"&gt;
    &lt;geometry&gt;
      ...
    &lt;/geometry&gt;
    &lt;drake:proximity_properties&gt;
      &lt;drake:compliant_hydroelastic/&gt;
      &lt;drake:mesh_resolution_hint&gt;0.1&lt;/drake:mesh_resolution_hint&gt;
      &lt;drake:hydroelastic_modulus&gt;5e7&lt;/drake:hydroelastic_modulus&gt;
      &lt;drake:hunt_crossley_dissipation&gt;1.25&lt;/drake:hunt_crossley_dissipation&gt;
    &lt;/drake:proximity_properties&gt;
  &lt;/collision&gt;
…
</pre><p>For a body, we’ve defined a collision geometry called “body1_collision”. Inside the &lt;collision&gt; tag (as a sibling to the &lt;geometry&gt; tag), we’ve introduced the Drake-specific &lt;drake:proximity_properties&gt; tag. In it we’ve defined the geometry to be compliant for hydroelastic contact and specified its resolution hint, its hydroelastic modulus, and its dissipation.</p>
<p>Let’s look at the specific tags:</p>
<ul>
<li>&lt;<a class="el" href="group__multibody__parsing.html#tag_drake_proximity_properties">drake:proximity_properties</a>&gt;: This is the container for all Drake-specific proximity property values.</li>
<li>The following tags define hydroelastic properties for the collision geometry and would be contained in the &lt;<a class="el" href="group__multibody__parsing.html#tag_drake_proximity_properties">drake:proximity_properties</a>&gt; tag.<ul>
<li>&lt;<a class="el" href="group__multibody__parsing.html#tag_drake_rigid_hydroelastic">drake:rigid_hydroelastic</a>&gt; or &lt;<a class="el" href="group__multibody__parsing.html#tag_drake_compliant_hydroelastic">drake:compliant_hydroelastic</a>&gt;</li>
<li>&lt;<a class="el" href="group__multibody__parsing.html#tag_drake_mesh_resolution_hint">drake:mesh_resolution_hint</a>&gt;</li>
<li>&lt;<a class="el" href="group__multibody__parsing.html#tag_drake_hydroelastic_modulus">drake:hydroelastic_modulus</a>&gt; (for compliant geometry only)</li>
<li>&lt;<a class="el" href="group__multibody__parsing.html#tag_drake_hunt_crossley_dissipation">drake:hunt_crossley_dissipation</a>&gt;</li>
</ul>
</li>
<li>In the name of completeness, the following tags would be children of the &lt;<a class="el" href="group__multibody__parsing.html#tag_drake_proximity_properties">drake:proximity_properties</a>&gt; tag as well, but are not restricted to use with hydroelastic contact.<ul>
<li>&lt;<a class="el" href="group__multibody__parsing.html#tag_drake_point_contact_stiffness">drake:point_contact_stiffness</a>&gt;: Only used when this geometry is for point contact. Defines the compliance of the point contact. This property is allowed to exist even if the geometry has been specified to be of hydroelastic type, it will have no effect on hydroelastic computations.</li>
<li>&lt;<a class="el" href="group__multibody__parsing.html#tag_drake_mu_static">drake:mu_static</a>&gt; The coefficient for static friction; this applies to both point contact and hydroelastic contact.</li>
<li>&lt;<a class="el" href="group__multibody__parsing.html#tag_drake_mu_dynamic">drake:mu_dynamic</a>&gt; The coefficient for dynamic friction; this applies to both point contact and hydroelastic contact.</li>
</ul>
</li>
</ul>
<h4><a class="anchor" id="hug_code_properties"></a>
Assigning hydroelastic properties in code</h4>
<p>Hydroelastic properties can be set to objects programmatically via the following APIs (see their documentation for further details):</p>
<ul>
<li><a class="el" href="namespacedrake_1_1geometry.html#a06f08c367a0ef97e7fc397a8a44d49d8" title="AddContactMaterial() adds general contact material properties to the given set of proximity propertie...">AddContactMaterial()</a></li>
<li><a class="el" href="namespacedrake_1_1geometry.html#af76ed94bef3f81765a1b3ce069562e00" title="Adds properties to the given set of proximity properties sufficient to cause the associated geometry ...">AddRigidHydroelasticProperties()</a></li>
<li><a class="el" href="namespacedrake_1_1geometry.html#a5a4cec840d5cb801271dbe609deaf0fe" title="Adds properties to the given set of proximity properties sufficient to cause the associated geometry ...">AddCompliantHydroelasticProperties()</a></li>
<li><a class="el" href="namespacedrake_1_1geometry.html#a331f457a6ce0d146213faa844725dcda" title="Compliant half spaces are handled as a special case; they do not get tessellated.">AddCompliantHydroelasticPropertiesForHalfSpace()</a></li>
</ul>
<p>Some extra notes:</p>
<p><a class="el" href="namespacedrake_1_1geometry.html#a06f08c367a0ef97e7fc397a8a44d49d8" title="AddContactMaterial() adds general contact material properties to the given set of proximity propertie...">AddContactMaterial()</a> isn’t hydroelastic contact specific, but does provide a mechanism for setting the friction coefficients that hydroelastic and point contact models both use.</p>
<p><a class="el" href="namespacedrake_1_1geometry.html#af76ed94bef3f81765a1b3ce069562e00" title="Adds properties to the given set of proximity properties sufficient to cause the associated geometry ...">AddRigidHydroelasticProperties()</a> is overloaded. One version accepts a value for resolution hint, one does not. When in doubt which to use, it is harmless to provide a resolution hint value that would be ignored for some geometries, but failing to provide one where necessary will cause the simulation to throw an exception. Note the special case for declaring a compliant half space &ndash; it takes the required slab thickness parameter in addition to the hydroelastic modulus value.</p>
<h2><a class="anchor" id="hug_visualizing"></a>
Visualizing hydroelastic contact</h2>
<p>Currently we can visualize the contact surface using Drake Visualizer; however, it will be replaced by <a href="https://github.com/rdeits/meshcat">MeshCat</a> in the future.</p>
<p>Start Drake Visualizer by: </p><pre class="fragment">$ bazel run //tools:drake_visualizer &amp;
</pre><p>Run a simulation with hydroelastic contact model; for example, </p><pre class="fragment">$ bazel run //examples/hydroelastic/ball_plate:ball_plate_run_dynamics -- \
   --mbp_dt=0.001 --simulator_publish_every_time_step --x0=0.10 --z0=0.15 \
   --simulation_time=0.015 --simulator_target_realtime_rate=0.05 --vz=-7.0
</pre><p>By default, at the time of this writing, Drake Visualizer will look like this:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter"></th><th class="markdownTableHeadCenter"></th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter"><div class="image">
<img src="drake-vis-01.png" alt="drake-vis-01.png" width="90%"/>
</div>
 </td><td class="markdownTableBodyCenter"><div class="image">
<img src="drake-vis-02.png" alt="drake-vis-02.png" width="95%"/>
</div>
  </td></tr>
</table>
<p>In the above pictures, we see two red force vectors acting at the centroids of the two contact surfaces and also the blue moment vector. One contact surface represents the ball pushing the dinner plate down. The other contact surface represents the rectangular floor pushing the dinner plate up. Gravity forces are not shown.</p>
<p>In the next picture, we zoom-in and rotate to show the contact surface between the dinner plate and the floor better. The ball is pushing one side of the plate downward enough that only half of the bottom of the plate makes contact with the floor.</p>
<div class="image">
<img src="drake-vis-03.png" alt="drake-vis-03.png"/>
</div>
<p>The Scene Browser lists all the hydroelastic contacts. We can turn off the plate-ball contact keeping only the plate-floor contact for clarity. Use the “eye” icon to toggle off the ball-plate contact as shown in the following picture. We can also make the dinner plate transparent too.</p>
<div class="image">
<img src="drake-vis-04.png" alt="drake-vis-04.png"/>
</div>
<p>To customize the contact visualization, go to the following menu: </p><pre class="fragment">Plugins` &gt; `Contacts` &gt; `Configure Hydroelastic Contact Visualization
</pre><div class="image">
<img src="drake-vis-05.png" alt="drake-vis-05.png"/>
</div>
<p>You can set <code>Maximum pressure</code> to what is observed (5e4 Pa in this example, default 1e8 Pa), so the shading of the contact surface looks more reasonable in the following picture:</p>
<div class="image">
<img src="drake-vis-06.png" alt="drake-vis-06.png"/>
</div>
<p>You can set <code>Edge width</code> of the white meshes of the contact surface with options to toggle the pressure shading (<code>Render contact surface with pressure</code>) and the contact mesh (<code>Render contact surface edges</code>).</p>
<p>By default, the force vectors are drawn at fixed length. We can draw each force according to its magnitude by <code>Vector scaling mode</code> and <code>Global scale of all vectors</code>. The following picture shows that the floor-plate contact force is slightly stronger than the floor-ball contact force to compensate for gravity. </p><pre class="fragment">Vector scaling mode = Scaled (default Fixed Length)
Global scale of all vectors = 0.001 (default 0.300)
</pre><div class="image">
<img src="drake-vis-07.png" alt="drake-vis-07.png"/>
</div>
<h2><a class="anchor" id="hug_pitfalls"></a>
Pitfalls/Troubleshooting</h2>
<p>Here are various ways that hydroelastic contact may surprise you.</p><ul>
<li>By default, a rigid body is not a rigid hydroelastic body until users say so. Otherwise, it is ignored by the hydroelastic contact model and might get point contact instead.<ul>
<li>Users need to call <a class="el" href="namespacedrake_1_1geometry.html#af76ed94bef3f81765a1b3ce069562e00" title="Adds properties to the given set of proximity properties sufficient to cause the associated geometry ...">AddRigidHydroelasticProperties()</a> or use the URDF or SDFormat tag &lt;drake:rigid_hydroelastic/&gt;.</li>
</ul>
</li>
<li>Backface culling &ndash; the visualized contact surface is not what you expect. Or, “Why are there holes?”</li>
<li>Hydroelastic modulus is not properly a material property; it combines material and geometry.<ul>
<li>Make the sphere bigger, the force gets weaker for the same contact surface.</li>
</ul>
</li>
<li>“I don’t seem to be getting any contact surfaces although my spheres are clearly overlapping!” Depending on how coarsely you tessellated your geometry (a sphere, at its coarsest, is an octahedron), there can be a large amount of error between the primitive surface and discrete mesh’s surface. Make sure you visualize the hydro meshes and have what you expect.</li>
<li>Stiff and coarse is seldom a good thing. The stiffer an object is, the more the details of the discrete tessellation will directly contribute to the dynamics.</li>
<li>Getting moments out of the contact depends on how many elements are in the contact surface. If the elements of the two contributing meshes are much larger than the actual contact surface, the contact can become, in essence, point contact.</li>
<li>Half spaces are not represented by meshes. They don’t contribute <em>any</em> geometry to the resultant contact surface. The contact surface’s refinement will depend on the other geometry’s level of refinement.</li>
</ul>
<h3><a class="anchor" id="hug_tips"></a>
Tips and Tricks</h3>
<p>This is a random collection of things we can do to maximize the benefits of the hydroelastic contact model. Some of these tricks accommodate current implementation limitations, and some are to work within the theoretical framework.</p>
<h4><a class="anchor" id="hug_gaming"></a>
Gaming the model</h4>
<ul>
<li>Rigid meshes need not be closed. You can use this to provide fine grained control over where a contact surface can actually exist. Be careful to have a consistent direction of surface normals on the triangles. They should point outward.</li>
<li>For a given relative configuration between bodies, the magnitude of force can be tuned in two ways: increasing the hydroelastic modulus and/or scaling the geometry up (in essence, increasing the average penetration depth).</li>
</ul>
<h1><a class="anchor" id="hydro_appendix_a"></a>
Appendix A: Compliant Contact Models</h1>
<h2><a class="anchor" id="hug_point_contact_theory"></a>
Compliant Point Contact</h2>
<p>Before we get into hydroelastic contact, it’s worth describing the compliant point contact model as a reference model. The point contact model defines the contact force by determining the minimum translational displacement (MTD). The minimum translational displacement is the smallest relative displacement between two volumes that will take them from intersecting to just touching. This quantity need not be unique (if two spheres have coincident centers, any direction will serve). Once we have this displacement, we get three quantities that we use to define the contact force:</p><ul>
<li>The direction of the displacement vector is the contact normal.</li>
<li>The magnitude is a measure of the amount of penetration (and is correlated with the magnitude of the normal component of the contact force).</li>
<li>Two witness points for the MTD. The witness points comprise one point on the surface of each volume such that when we apply the minimum translational displacement, they are coincident. We use the witness points (and other physical parameters) to define the point at which the contact force is applied.</li>
</ul>
<p>This model is simple to implement and cheap to compute, but has some drawbacks.</p>
<ul>
<li>A single measure of “maximum penetration” cannot distinguish between a large intersecting volume and a small intersecting volume (see Figure 1). The two intersections would produce the same amount of contact force despite the fact that one is clearly compressing more material.</li>
<li>Contact along a large interface is treated as contact at a single point (see Figure 2). Effects that depend on a contact interface over a domain with non-zero area disappear (e.g., torsional friction).</li>
<li>The witness points are not necessarily unique. This means, generally, there is no guarantee that the witness points will be consistent from frame to frame, which means that the point at which the force is applied will not be consistent. This can produce non-physical artifacts like sudden changes in force direction.</li>
</ul>
<div class="image">
<img src="contact-fig-01.png" alt="contact-fig-01.png"/>
</div>
<p>Figure 1: Two intersections with significantly different intersecting volumes characterized with the same measure: d.</p>
<div class="image">
<img src="contact-fig-02.png" alt="contact-fig-02.png"/>
</div>
<p>Figure 2: Modeling contact forces with point contact (considering the blue half space as rigid). (a) the actual intersection of the simulated bodies. (b) the conceptual deformation of the orange body creating a large area of contact. (c) how point contact sees the deformation: contact at a single point.</p>
<p>Hydroelastic contact was created to address some of the short-comings in point contact. In fact, one might argue that many of the strategies used to mitigate the shortcomings of point contact (such as using lots of points) push it closer and closer to hydroelastic contact.</p>
<h2><a class="anchor" id="hug_hydro_theory"></a>
Hydroelastic Contact</h2>
<p>Hydroelastic Contact is another compliant contact formulation. It was originally introduced by <a class="el" href="group__hydroelastic__user__guide.html#Elandt2019">[Elandt 2019]</a>. Modifications and further development of the model can be found in <a class="el" href="group__hydroelastic__user__guide.html#Masterjohn2021">[Masterjohn 2021]</a>. In Drake, we refer to this model as the “hydroelastic” model. It differs from point contact in how it characterizes the contact. Rather than a single point, it imagines an entire contact surface. This surface is an approximation of the contact surface as visualized in Figure 2(b).</p>
<p>When two objects come into contact, forces are produced due to deformation ("strain") of the objects at the contact interface. At first touch, there are no forces but as the objects are pressed further they deform to produce a region over which contact pressure is non-zero, causing equal-and-opposite forces to act on the objects. Calculating the actual deformations is expensive. Hydroelastic contact is based on the idea that for relatively small deformations we can approximate the resulting contact interface and pressure distribution without having to compute the actual deformations. We do that by precalculating a "pressure field" on the interior of compliant objects (see Figure 3). The pressure field approximates the pressure that would result from deforming the surface to some point within the field. A point on the surface (that is, no deformation) experiences zero pressure, but as it is pressed inward, it experiences an increase in pressure (up to a maximum pressure on the interior of the body). When two bodies are colliding, we look for a surface in the intersecting volume where the pressure on the surface is the same in each object; it’s an equilibrium surface (see Figure 4). There is pressure defined across the entire contact surface. It is integrated to define the resultant contact force and moment.</p>
<div class="image">
<img src="contact-fig-03.png" alt="contact-fig-03.png"/>
</div>
<p>Figure 3: Three shapes and possible pressure fields in the interior of the object. Pressure is zero at the outer boundary, and maximum on the interior.</p>
<div class="image">
<img src="contact-fig-04.png" alt="contact-fig-04.png"/>
</div>
<p>Figure 4: The equilibrium contact surface (pale green) between two bodies where the left-hand, yellow body has (a) less compliance, (b) equal compliance, and (c) greater compliance.</p>
<p>This equilibrium surface has important properties:</p><ul>
<li>The contact surface will always be contained within the intersecting volume.</li>
<li>The surface’s edge will always lie on the surface of both objects and have zero pressure.</li>
<li>The location of the surface depends on the relative compliance of the two objects. As one object becomes more rigid than the other, the contact surface begins to converge to its surface (see Figure 4). As one surface becomes perfectly rigid, the other object deforms completely to conform to its shape.</li>
<li>The contacting bodies need not be convex, nor will the contact surface between two objects necessarily be a single contiguous patch. For non-convex geometries, the contact can be meaningfully represented by multiple disjoint patches. The resultant contact force will still be meaningful.</li>
<li>The resultant contact force is continuous with respect to the relative pose between bodies. In fact, the contact surface’s mesh, its area, and the pressures measured on the surface are likewise continuous.</li>
</ul>
<h2><a class="anchor" id="hug_hydro_practice"></a>
Hydroelastic Contact in practice</h2>
<p>The theory operates on arbitrary geometries and pressure fields. In practice, we operate on discrete representations of both the geometry and the field.</p>
<p>Compliant objects are represented by tetrahedral meshes. The Drake data type is <a class="el" href="classdrake_1_1geometry_1_1_volume_mesh.html">VolumeMesh</a>. The pressure fields on those meshes are piecewise linear.</p>
<p>The resulting contact surface is likewise a discrete mesh. This mesh may be built of nothing but triangles or polygons. The choice of representation has various implications on the computation of contact forces (see below). The pressure on the contact surface is likewise a piecewise linear function.</p>
<p>We model perfectly rigid objects (objects with no compliance at all) as triangle surface meshes. They have no pressure field associated with them because any penetration from the surface instantaneously produces infinite pressure. When colliding a rigid object against a compliant object, the contact surface always follows the surface of the rigid object. Think of it as the compliant object doing 100% of the deformation, so it conforms to the shape of the rigid object.</p>
<p>Important points to note:</p><ul>
<li>The time cost of resolving contact scales with the complexity of the contact surface (number of faces).</li>
<li>The complexity of the contact surface is a function of the complexity of the contacting geometries.</li>
<li>The best performance comes from the lowest resolution meshes that produce “acceptable” behaviors.</li>
<li>It is not universally true that every geometry is represented discretely. The implementation may represent some shapes differently when it allows performance improvements. The canonical example would be a half space geometry. As a shape with infinite volume, it would be infeasible to create a finite, discrete representation. It is also unnecessary. Intersecting meshes directly with a half space is far more efficient.</li>
<li>When an object is very near rigid it is more efficient to model it as rigid than as a very stiff compliant object. Modeling as rigid allows us to take advantage of the fact that the contact surface will lie on the surface of the rigid object.</li>
</ul>
<h1><a class="anchor" id="hydro_appendix_b"></a>
Appendix B: Current state of implementation</h1>
<p>The implementation of hydroelastic contact in Drake is still under active development. This section will be updated as the scope and feature set of hydroelastic contact is advanced. The main crux of this section is to clearly indicate what can and cannot be done with hydroelastic contact.</p>
<h2><a class="anchor" id="hug_implemented"></a>
What can you do with hydroelastic contact?</h2>
<ul>
<li>Hydroelastic contact can be used with MultibodyPlant in either continuous or discrete mode.</li>
<li>You can visualize the contact surfaces, their pressure fields, and the resultant contact forces in Drake Visualizer (see <a class="el" href="group__hydroelastic__user__guide.html#hug_visualizing">Visualizing hydroelastic contact</a>).</li>
<li>All Drake Shape types can be used to create rigid hydroelastic bodies (this includes arbitrary meshes defined as OBJs).</li>
<li>Drake primitive Shape types (Box, Capsule, Cylinder, Ellipsoid, HalfSpace, and Cylinder) can all be used to create compliant hydroelastic bodies.</li>
</ul>
<h2><a class="anchor" id="hug_not_yet_implemented"></a>
What can’t you do with hydroelastic contact?</h2>
<ul>
<li>You can’t get contact surfaces between two rigid geometries. The contact surface between rigid geometries is ill defined and will most likely never be supported. If you need rigid-rigid contact, consider hydroelastics with fallback (kHydroelasticWithFallback). See <a class="el" href="group__hydroelastic__user__guide.html#hug_enabling">Enabling Hydroelastic contact in your simulation</a> on how to deal with contact in these cases.</li>
<li>Drake Mesh and Convex types cannot currently serve as a compliant hydroelastic geometry.</li>
<li>Hydroelastics cannot model true deformations given the model does not introduce state. Therefore effects such as tangential compliance or short time scale waves are not captured by the model.</li>
</ul>
<h1><a class="anchor" id="hydro_references"></a>
Sources referenced within this documentation</h1>
<ul>
<li><a class="anchor" id="Elandt2019"></a>[Elandt 2019] Elandt, R., Drumwright, E., Sherman, M., &amp; Ruina, A. (2019, November). A pressure field model for fast, robust approximation of net contact force and moment between nominally rigid objects. In 2019 IEEE/RSJ International Conference on Intelligent Robots and Systems(IROS) (pp. 8238-8245). IEEE. <a href="https://arxiv.org/abs/1904.11433">https://arxiv.org/abs/1904.11433</a> .</li>
<li><a class="anchor" id="Masterjohn2021"></a>[Masterjohn 2021] Masterjohn, J., Guoy, D., Shepherd, J., &amp; Castro, A. (2021). Discrete Approximation of Pressure Field Contact Patches. arXiv preprint arXiv:2110.04157. <a href="https://arxiv.org/abs/2110.04157">https://arxiv.org/abs/2110.04157</a> . </li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- footer -->
<div id="nav-path" class="navpath">
  <ul>
  </ul>
</div>
<script type="text/javascript">
searchBox.searchLabel = 'Go to name…';
searchBox.DOMSearchField().value = searchBox.searchLabel;
</script>
</body>
</html>
