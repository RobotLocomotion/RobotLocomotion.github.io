<!-- HTML header for doxygen 1.15.0-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Drake: System Scalar Conversion</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(function() { init_search(); });
</script>
<script type="text/javascript">
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  }
};
</script>
<script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@4/tex-chtml.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_extra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<header class="site-header">
 <div class="site-header-inner contain">
  <a class="drake-logo" href="/"><img src="/images/drake-logo-white.svg"></a>
  <div class="menu-mobile-toggle">
   <span></span>
  </div>
  <nav class="site-menu">
   <ul>
    <li class="site-menu-item site-menu-item-main">
     <a class="site-menu-item" href="/">Home</a>
    </li>
    <li class="site-menu-item site-menu-item-main">
     <a class="site-menu-item" href="/installation.html">Installation</a>
    </li>
    <li class="site-menu-item site-menu-item-main">
     <a class="site-menu-item" href="/gallery.html">Gallery</a>
    </li>
    <li class="site-menu-item site-menu-item-main">API Documentation
     <div class="sub">
      <a class="site-menu-item" href="/doxygen_cxx/index.html">C++</a>
      <a class="site-menu-item" href="/pydrake/index.html">Python</a>
     </div>
    </li>
    <li class="site-menu-item site-menu-item-main">Resources
     <div class="sub">
      <a class="site-menu-item" href="/getting_help.html">Getting Help</a>
      <a class="site-menu-item" href="https://deepnote.com/workspace/Drake-0b3b2c53-a7ad-441b-80f8-bf8350752305/project/Tutorials-2b4fc509-aef2-417d-a40d-6071dfed9199/notebook/index-753e3c9d261247ba9f0eb1d7868c18c8">Tutorials</a>
      <a class="site-menu-item" href="/python_bindings.html">Python Bindings</a>
      <a class="site-menu-item" href="/developers.html">For Developers</a>
      <a class="site-menu-item" href="/credits.html">Credits</a>
     </div>
    </li>
    <li class="github-link">
     <a class="site-menu-item" href="https://github.com/RobotLocomotion/drake">GitHub <img src="/third_party/images/GitHub-Mark-Light-64px.png"></a>
    </li>
   </ul>
  </nav>
 </div>
</header>
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Drake
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<div class="title-banner">
 <div class="title-banner__title">
  Drake C++ Documentation
 </div>
 <div id="DDGSearch">
  <form id="search_form_cpp" class="wy_form" action="https://google.com/search" method="get">
   <input type="text" name="q" placeholder="Search C++ API only…">
   <input type="hidden" name="q" value="site:drake.mit.edu/doxygen_cxx">
  </form>
  <form id="search_form" class="wy_form" action="https://google.com/search" method="get">
   <input type="text" name="q" placeholder="Search all of Drake…">
   <input type="hidden" name="q" value="site:drake.mit.edu OR site:underactuated.csail.mit.edu OR site:manipulation.csail.mit.edu">
  </form>
 </div>
 <div id="MSearchBoxContainer">
  <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect" class="search-icon" onmouseover="return searchBox.OnSearchSelectShow()" onmouseout="return searchBox.OnSearchSelectHide()"><span class="search-icon-dropdown"></span></span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><div id="MSearchCloseImg" class="close-icon"></div></a>
          </span>
        </div>
</td>
 </div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('group__system__scalar__conversion.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">System Scalar Conversion <div class="ingroups"><a class="el" href="group__technical__notes.html">Technical Notes</a></div></div></div>
</div><!--header-->
<div class="contents">
<p>System scalar conversion refers to cloning a System templatized by one scalar type into an identical System that is templatized by a different scalar type. </p>
<p>For example, a <span class="tt">MySystem&lt;double&gt;</span> could be cloned to create a <span class="tt">MySystem&lt;AutoDiffXd&gt;</span> in order to compute the partial numerical derivatives.</p>
<p>See the <a class="el" href="group__default__scalars.html">default scalars</a> for list of supported types.</p>
<h2>Example use of system scalar conversion</h2>
<p>This is a small example to illustrate the concept.</p>
<div class="fragment"><div class="line"><span class="comment">// Establish the plant and its initial conditions:</span></div>
<div class="line"><span class="comment">//   tau = 0, theta = 0.1, thetadot = 0.2.</span></div>
<div class="line"><span class="keyword">auto</span> plant = std::make_unique&lt;PendulumPlant&lt;double&gt;&gt;();</div>
<div class="line"><span class="keyword">auto</span> context = plant-&gt;CreateDefaultContext();</div>
<div class="line">plant-&gt;get_input_port(0).FixValue(context.get(), 0.0);  <span class="comment">// tau</span></div>
<div class="line"><span class="keyword">auto</span>* state = <span class="keyword">dynamic_cast&lt;</span>PendulumState&lt;double&gt;*<span class="keyword">&gt;</span>(</div>
<div class="line">    context-&gt;get_mutable_continuous_state_vector());</div>
<div class="line">state-&gt;set_theta(0.1);</div>
<div class="line">state-&gt;set_thetadot(0.2);</div>
<div class="line"><span class="keywordtype">double</span> energy = plant-&gt;CalcTotalEnergy(*context);</div>
<div class="line">ASSERT_NEAR(energy, -4.875, 0.001);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Convert the plant and its context to use AutoDiff.</span></div>
<div class="line"><span class="keyword">auto</span> autodiff_plant = System&lt;double&gt;::ToAutoDiffXd(*plant);</div>
<div class="line"><span class="keyword">auto</span> autodiff_context = autodiff_plant-&gt;CreateDefaultContext();</div>
<div class="line">autodiff_context-&gt;SetTimeStateAndParametersFrom(*context);</div>
<div class="line">autodiff_plant-&gt;FixInputPortsFrom(*plant, *context, autodiff_context.get());</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Differentiate with respect to theta by setting dtheta/dtheta = 1.0.</span></div>
<div class="line"><span class="keyword">constexpr</span> <span class="keywordtype">int</span> kNumDerivatives = 1;</div>
<div class="line"><span class="keyword">auto</span>&amp; xc = *autodiff_context-&gt;get_mutable_continuous_state_vector();</div>
<div class="line">xc[PendulumStateIndices::kTheta].derivatives() =</div>
<div class="line">    MatrixXd::Identity(kNumDerivatives, kNumDerivatives).col(0);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Compute denergy/dtheta around its initial conditions.</span></div>
<div class="line">AutoDiffXd autodiff_energy =</div>
<div class="line">    autodiff_plant-&gt;CalcTotalEnergy(*autodiff_context);</div>
<div class="line">ASSERT_NEAR(autodiff_energy.value(), -4.875, 0.001);</div>
<div class="line">ASSERT_EQ(autodiff_energy.derivatives().size(), 1);</div>
<div class="line">ASSERT_NEAR(autodiff_energy.derivatives()[0], 0.490, 0.001);</div>
</div><!-- fragment --><p>For a more thorough example, refer to the implementation of <a class="el" href="group__primitive__systems.html#ga7c66291c5e9eafd1cfc9f025665d0041" title="Takes the first-order Taylor expansion of a System around a nominal operating point (defined by the C...">drake::systems::Linearize</a>.</p>
<dl class="section warning"><dt>Warning</dt><dd>The supported method to perform scalar conversion uses the member functions on System, e.g., <span class="tt">System::ToAutoDiffXd</span>. The scalar-converting copy constructor (described below) is intended for internal use only. For example: <div class="fragment"><div class="line">PendulumPlant&lt;double&gt; plant;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// WRONG</span></div>
<div class="line">PendulumPlant&lt;AutoDiffXd&gt; plant_autodiff(plant);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// CORRECT</span></div>
<div class="line">std::unique_ptr&lt;PendulumPlant&lt;AutoDiffXd&gt;&gt; autodiff_plant =</div>
<div class="line">    System&lt;double&gt;::ToAutoDiffXd(plant);</div>
</div><!-- fragment --></dd></dl>
<p><a class="anchor" id="system_scalar_conversion_how_to_write_a_system"></a></p><h2>How to write a System that supports scalar conversion</h2>
<p>In the typical case, Drake users' Systems should be marked with the C++ keyword <span class="tt">final</span> to prevent them from being subclassed. Whether or not the System is <span class="tt">final</span> determines the best way to support scalar conversion.</p>
<p>In the examples below, we use <span class="tt">MySystem</span> as the name of a System class being implemented by a Drake user.</p>
<h3>Systems marked as <span class="tt">final</span></h3>
<p>For system marked with <span class="tt">final</span>, the two examples below show how to enable system scalar conversion.</p>
<p>Example using <a class="el" href="classdrake_1_1systems_1_1_leaf_system.html" title="A superclass template that extends System with some convenience utilities that are not applicable to ...">drake::systems::LeafSystem</a> as the base class: </p><div class="fragment"><div class="line"><span class="keyword">namespace </span>sample {</div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><span class="keyword">class </span>MySystem final : <span class="keyword">public</span> LeafSystem&lt;T&gt; {</div>
<div class="line"> <span class="keyword">public</span>:</div>
<div class="line">  <a class="code hl_define" href="drake__copyable_8h.html#a3ee22789c29a46dddd6a7fd2b982731c">DRAKE_NO_COPY_NO_MOVE_NO_ASSIGN</a>(MySystem);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Constructs a system with a gain of 1.0.</span></div>
<div class="line">  MySystem() : MySystem(1.0) {}</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Constructs a system with the given `gain`.</span></div>
<div class="line">  <span class="keyword">explicit</span> MySystem(<span class="keywordtype">double</span> gain)</div>
<div class="line">    : LeafSystem&lt;T&gt;(SystemTypeTag&lt;MySystem&gt;{}), gain_{gain} {}</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Scalar-converting copy constructor.  See @ref system_scalar_conversion.</span></div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> U&gt;</div>
<div class="line">  <span class="keyword">explicit</span> MySystem(<span class="keyword">const</span> MySystem&lt;U&gt;&amp; other) : MySystem&lt;T&gt;(other.gain()) {}</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Returns the gain of this system.</span></div>
<div class="line">  <span class="keywordtype">double</span> gain()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> gain_; }</div>
<div class="line"> </div>
<div class="line">  ...</div>
<div class="ttc" id="adrake__copyable_8h_html_a3ee22789c29a46dddd6a7fd2b982731c"><div class="ttname"><a href="drake__copyable_8h.html#a3ee22789c29a46dddd6a7fd2b982731c">DRAKE_NO_COPY_NO_MOVE_NO_ASSIGN</a></div><div class="ttdeci">#define DRAKE_NO_COPY_NO_MOVE_NO_ASSIGN(Classname)</div><div class="ttdoc">DRAKE_NO_COPY_NO_MOVE_NO_ASSIGN deletes the special member functions for copy-construction,...</div><div class="ttdef"><b>Definition</b> drake_copyable.h:31</div></div>
</div><!-- fragment --><p>Example using <a class="el" href="classdrake_1_1systems_1_1_vector_system.html" title="A base class that specializes LeafSystem for use with only zero or one vector input ports,...">drake::systems::VectorSystem</a> as the base class: </p><div class="fragment"><div class="line"><span class="keyword">namespace </span>sample {</div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><span class="keyword">class </span>MySystem final : <span class="keyword">public</span> VectorSystem&lt;T&gt; {</div>
<div class="line"> <span class="keyword">public</span>:</div>
<div class="line">  <a class="code hl_define" href="drake__copyable_8h.html#a3ee22789c29a46dddd6a7fd2b982731c">DRAKE_NO_COPY_NO_MOVE_NO_ASSIGN</a>(MySystem);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Default constructor.</span></div>
<div class="line">  MySystem() : VectorSystem&lt;T&gt;(SystemTypeTag&lt;MySystem&gt;{}, 1, 1) {}</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Scalar-converting copy constructor.  See @ref system_scalar_conversion.</span></div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> U&gt;</div>
<div class="line">  <span class="keyword">explicit</span> MySystem(<span class="keyword">const</span> MySystem&lt;U&gt;&amp;) : MySystem&lt;T&gt;() {}</div>
<div class="line"> </div>
<div class="line">  ...</div>
</div><!-- fragment --><p>The relevant details of the examples are:</p><ul>
<li><span class="tt">MySystem</span> is templated on a scalar type <span class="tt">T</span>;</li>
<li><span class="tt">MySystem</span> is marked <span class="tt">final</span>;</li>
<li><span class="tt">DRAKE_NO_COPY_...</span> disables the built-in copy and move constructors;</li>
<li><span class="tt">MySystem</span> has whatever usual constructors make sense;<ul>
<li>sometimes it will have a default constructor;</li>
<li>sometimes it will be given arguments in its constructor;</li>
<li>as a C++ best practice, constructors should delegate into one primary constructor;<ul>
<li>we see that above in the first example where the default constructor delegates to the one-argument constructor;</li>
</ul>
</li>
<li>all <span class="tt">MySystem</span> constructors must pass a <span class="tt">SystemTypeTag</span> to their superclass constructor; if all <span class="tt">MySystem</span> constructors delegate to a single one, this is easy because only that one needs to provide the <span class="tt">SystemTypeTag</span> value;</li>
</ul>
</li>
<li><span class="tt">MySystem</span> has a public scalar-converting copy constructor;<ul>
<li>the constructor takes a reference to <span class="tt">MySystem&lt;U&gt;</span> and delegates to another constructor;</li>
<li>the section <em>How to write a scalar-converting copy constructor</em> below provides more details on how to implement this constructor.</li>
</ul>
</li>
</ul>
<h3>Systems not marked as <span class="tt">final</span></h3>
<p>For a class hierarchy of Systems that support scalar conversion, a slightly different pattern is required.</p>
<div class="fragment"><div class="line"><span class="keyword">namespace </span>sample {</div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><span class="keyword">class </span>MySystemBase : <span class="keyword">public</span> LeafSystem&lt;T&gt; {</div>
<div class="line"> <span class="keyword">public</span>:</div>
<div class="line">  <a class="code hl_define" href="drake__copyable_8h.html#a3ee22789c29a46dddd6a7fd2b982731c">DRAKE_NO_COPY_NO_MOVE_NO_ASSIGN</a>(MySystemBase);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Constructs a system with the given `gain`.</span></div>
<div class="line">  <span class="comment">// Subclasses must use the protected constructor, not this one.</span></div>
<div class="line">  <span class="keyword">explicit</span> MySystemBase(<span class="keywordtype">double</span> gain)</div>
<div class="line">    : LeafSystem&lt;T&gt;(SystemTypeTag&lt;MySystemBase&gt;{}), gain_{gain} {}</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Scalar-converting copy constructor.  See @ref system_scalar_conversion.</span></div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> U&gt;</div>
<div class="line">  <span class="keyword">explicit</span> MySystemBase(<span class="keyword">const</span> MySystemBase&lt;U&gt;&amp; other)</div>
<div class="line">    : MySystemBase&lt;T&gt;(other.gain()) {}</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Returns the gain of this system.</span></div>
<div class="line">  <span class="keywordtype">double</span> gain()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> gain_; }</div>
<div class="line"> </div>
<div class="line"> <span class="keyword">protected</span>:</div>
<div class="line">  <span class="comment">// Constructor that specifies scalar-type conversion support.</span></div>
<div class="line">  <span class="comment">// @param converter scalar-type conversion support helper (i.e., AutoDiff,</span></div>
<div class="line">  <span class="comment">// etc.); pass a default-constructed object if such support is not desired.</span></div>
<div class="line">  <span class="keyword">explicit</span> MySystemBase(SystemScalarConverter converter, <span class="keywordtype">double</span> gain)</div>
<div class="line">    : LeafSystem&lt;T&gt;(std::move(converter)), gain_{gain} {}</div>
<div class="line"> </div>
<div class="line">  ...</div>
<div class="line">namespace sample {</div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><span class="keyword">class </span>MySystemDerived final : <span class="keyword">public</span> MySystemBase&lt;T&gt; {</div>
<div class="line"> <span class="keyword">public</span>:</div>
<div class="line">  <a class="code hl_define" href="drake__copyable_8h.html#a3ee22789c29a46dddd6a7fd2b982731c">DRAKE_NO_COPY_NO_MOVE_NO_ASSIGN</a>(MySystemDerived);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Constructs a system with a gain of 1.0.</span></div>
<div class="line">  MySystemDerived() : MySystemBase&lt;T&gt;(</div>
<div class="line">      SystemTypeTag&lt;MySystemDerived&gt;{},</div>
<div class="line">      1.0) {}</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Scalar-converting copy constructor.  See @ref system_scalar_conversion.</span></div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> U&gt;</div>
<div class="line">  <span class="keyword">explicit</span> MySystemDerived(<span class="keyword">const</span> MySystemDerived&lt;U&gt;&amp;) : MySystemDerived&lt;T&gt;() {}</div>
<div class="line"> </div>
<div class="line">  ...</div>
</div><!-- fragment --><p>The relevant details of the examples are:</p><ul>
<li>Non-<span class="tt">final</span> classes like <span class="tt">MySystemBase</span> must offer a protected constructor that takes a SystemScalarConverter as the first argument.</li>
<li>Constructors for derived classes such as <span class="tt">MySystemDerived</span> must delegate to a base class protected constructor that takes a SystemScalarConverter, never to a public constructor without one.</li>
<li><span class="tt">MySystemBase</span> and <span class="tt">MySystemDerived</span> both have a public scalar-converting copy constructor;<ul>
<li>if the base system is abstract (cannot be constructed), then it may omit this constructor.</li>
</ul>
</li>
</ul>
<h3>Limiting the supported scalar types</h3>
<p>The framework's default implementation System scalar-type conversion only converts between a limited set of scalar types, as enumerated by the drake::systems::SystemScalarConverter::SystemScalarConverter(SystemTypeTag&lt;S&gt;) constructor documentation.</p>
<p>Systems may specialize their <a class="el" href="structdrake_1_1systems_1_1scalar__conversion_1_1_traits.html" title="A templated traits class for whether an S&lt;U&gt; can be converted into an S&lt;T&gt;; the default value is true...">drake::systems::scalar_conversion::Traits</a> to govern the supported scalar types. The recommended mechanism is to use <a class="el" href="structdrake_1_1systems_1_1scalar__conversion_1_1_non_symbolic_traits.html" title="A concrete traits class providing sugar to disable support for symbolic evaluation (i....">drake::systems::scalar_conversion::NonSymbolicTraits</a> or <a class="el" href="structdrake_1_1systems_1_1scalar__conversion_1_1_from_double_traits.html" title="A concrete traits class providing sugar to support for converting only from the double scalar type.">drake::systems::scalar_conversion::FromDoubleTraits</a>.</p>
<h2>How to write a scalar-converting copy constructor</h2>
<p>The scalar-converting copy constructor uses the following form: </p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><span class="keyword">class </span>Foo {</div>
<div class="line">  <span class="comment">// Scalar-converting copy constructor.</span></div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> U&gt;</div>
<div class="line">  <span class="keyword">explicit</span> Foo(<span class="keyword">const</span> Foo&lt;U&gt;&amp; other);</div>
<div class="line">};</div>
</div><!-- fragment --><p>Here, <span class="tt">U</span> is the source scalar type (to convert from), and <span class="tt">T</span> the resulting scalar type (to convert into). For example, in the second line of </p><div class="fragment"><div class="line">Foo&lt;double&gt; foo;</div>
<div class="line">Foo&lt;AutoDiffXd&gt; autodiff_foo{foo};</div>
</div><!-- fragment --><p> we are calling the constructor <span class="tt">Foo&lt;AutoDiffXd&gt;::Foo(const Foo&lt;double&gt;&amp;)</span> so we have <span class="tt">U = double</span> and <span class="tt">T = AutoDiffXd</span>. In other words, we start with a <span class="tt">double</span>-valued object and use it to create an <span class="tt">AutoDiffXd</span>-valued object.</p>
<h3>Delegation</h3>
<p>In almost all cases, the implementation of the scalar-converting copy constructor should delegate to another regular constructor, rather than re-implementing its logic. For example, in the <span class="tt">VectorSystem</span>-based example above we have: </p><div class="fragment"><div class="line">MySystem() : VectorSystem&lt;T&gt;(SystemTypeTag&lt;MySystem&gt;{}, 1, 1) {}</div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> U&gt; <span class="keyword">explicit</span> MySystem(<span class="keyword">const</span> MySystem&lt;U&gt;&amp;) : MySystem&lt;T&gt;() {}</div>
</div><!-- fragment --><p> The default constructor configures the System to have a <span class="tt">input_size == 1</span> and <span class="tt">output_size == 1</span>. The scalar-converting copy constructor delegates to the default constructor to re-use that logic by stating <span class="tt">: MySystem&lt;T&gt;()</span>.</p>
<p>Without delegation, we would have to duplicate those arguments: </p><div class="fragment"><div class="line">MySystem() : VectorSystem&lt;T&gt;(SystemTypeTag&lt;MySystem&gt;{}, 1, 1) {}</div>
<div class="line"><span class="comment">// NOT RECOMMENDED because it duplicates the details of calling VectorSystem.</span></div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> U&gt; <span class="keyword">explicit</span> MySystem(<span class="keyword">const</span> MySystem&lt;U&gt;&amp;)</div>
<div class="line">  : VectorSystem&lt;T&gt;(SystemTypeTag&lt;MySystem&gt;{}, 1, 1) {}</div>
</div><!-- fragment --><h3>Instance data</h3>
<p>If the object being copied from (usually named <span class="tt">other</span>) has any instance data or customizations, the scalar-converting copy constructor should propagate them from <span class="tt">other</span> to <span class="tt">this</span>. For example, in the <span class="tt">LeafSystem</span>-based example above, we have: </p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> U&gt;</div>
<div class="line"><span class="keyword">explicit</span> MySystem(<span class="keyword">const</span> MySystem&lt;U&gt;&amp; other) : MySystem&lt;T&gt;(other.gain()) {}</div>
</div><!-- fragment --><h2>How to create a Diagram that supports scalar conversion</h2>
<p>In the typical case, no special effort is needed to create a Diagram that support scalar-type conversion. The Diagram does not even need to be templated on a scalar type <span class="tt">T</span>.</p>
<p>Example using DiagramBuilder::BuildInto: </p><div class="fragment"><div class="line"><span class="keyword">namespace </span>sample {</div>
<div class="line"><span class="keyword">class </span>MyDiagram : <span class="keyword">public</span> Diagram&lt;double&gt; {</div>
<div class="line"> <span class="keyword">public</span>:</div>
<div class="line">  MyDiagram() {</div>
<div class="line">    DiagramBuilder&lt;double&gt; builder;</div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">auto</span>* integrator = builder.AddSystem&lt;Integrator&lt;double&gt;&gt;(1);</div>
<div class="line">    builder.ExportInput(integrator-&gt;get_input_port());</div>
<div class="line">    builder.ExportOutput(integrator-&gt;get_output_port());</div>
<div class="line">    builder.BuildInto(<span class="keyword">this</span>);</div>
<div class="line">  }</div>
<div class="line">};</div>
</div><!-- fragment --><p>In this example, <span class="tt">MyDiagram</span> will support the same scalar types as the Integrator. If any sub-system had been added that did not support, e.g., symbolic form, then the Diagram would also not support symbolic form.</p>
<p>By default, even subclasses of a <span class="tt">Diagram&lt;U&gt;</span> will convert to a <span class="tt">Diagram&lt;T&gt;</span>, discarding the diagram subclass details. For example, in the above sample code, <span class="tt">MyDiagram::ToAutoDiffXd()</span> will return an object of runtime type <span class="tt">Diagram&lt;AutoDiffXd&gt;</span>, not type <span class="tt">MyDiagram&lt;AutoDiffXd&gt;</span>. (There is no such class as <span class="tt">MyDiagram&lt;AutoDiffXd&gt;</span> anyway, because <span class="tt">MyDiagram</span> is not templated.)</p>
<p>In the unusual case that the Diagram's subclass must be preserved during conversion, a <a class="el" href="structdrake_1_1systems_1_1_system_type_tag.html" title="A tag object that denotes a System subclass S in function signatures.">drake::systems::SystemTypeTag</a> should be used:</p>
<p>Example using DiagramBuilder::BuildInto along with a <span class="tt">SystemTypeTag</span>: </p><div class="fragment"><div class="line"><span class="keyword">namespace </span>sample {</div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><span class="keyword">class </span>SpecialDiagram&lt;T&gt; final : <span class="keyword">public</span> Diagram&lt;T&gt; {</div>
<div class="line"> <span class="keyword">public</span>:</div>
<div class="line">  SpecialDiagram() : Diagram&lt;T&gt;(SystemTypeTag&lt;SpecialDiagram&gt;{}) {</div>
<div class="line">    DiagramBuilder&lt;T&gt; builder;</div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">auto</span>* integrator = builder.template AddSystem&lt;Integrator&lt;T&gt;&gt;(1);</div>
<div class="line">    builder.ExportInput(integrator-&gt;get_input_port());</div>
<div class="line">    builder.ExportOutput(integrator-&gt;get_output_port());</div>
<div class="line">    builder.BuildInto(<span class="keyword">this</span>);</div>
<div class="line">  }</div>
<div class="line">  <span class="comment">// Scalar-converting copy constructor.  See @ref system_scalar_conversion.</span></div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> U&gt;</div>
<div class="line">  <span class="keyword">explicit</span> SpecialDiagram(<span class="keyword">const</span> SpecialDiagram&lt;U&gt;&amp; other)</div>
<div class="line">      : Diagram&lt;T&gt;(SystemTypeTag&lt;SpecialDiagram&gt;{}, other) {}</div>
<div class="line">};</div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- footer -->
<div class="navpath">
  <ul>
  </ul>
</div>
<footer id="nav-path", class="site-footer padding">
  <div class="contain">
    <a href="/" class="drake-logo">
      <img src="/images/drake-logo.svg"/>
    </a>
    <div class="footer-menu">
      <ul>    
        <li>
          <a href="/doxygen_cxx/index.html" class="site-menu-item">C++</a>
        </li>    
        <li>
          <a href="/pydrake/index.html" class="site-menu-item">Python</a>
        </li>
        <li class="github-link">
          <a href="https://github.com/RobotLocomotion/drake" class="site-menu-item">GitHub <img src="/third_party/images/GitHub-Mark-64px.png"/></a>
        </li>
      </ul>
    </div>
  </div>
</footer>
<script type="text/javascript">
searchBox.searchLabel = 'Go to name…';
searchBox.DOMSearchField().placeholder = searchBox.searchLabel;
searchBox.DOMSearchField().value = '';
</script>
</body>
</html>
