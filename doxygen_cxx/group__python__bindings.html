<!-- HTML header for doxygen 1.15.0-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Drake: Python Bindings</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(function() { init_search(); });
</script>
<script type="text/javascript">
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  }
};
</script>
<script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@4/tex-chtml.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_extra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<header class="site-header">
 <div class="site-header-inner contain">
  <a class="drake-logo" href="/"><img src="/images/drake-logo-white.svg"></a>
  <div class="menu-mobile-toggle">
   <span></span>
  </div>
  <nav class="site-menu">
   <ul>
    <li class="site-menu-item site-menu-item-main">
     <a class="site-menu-item" href="/">Home</a>
    </li>
    <li class="site-menu-item site-menu-item-main">
     <a class="site-menu-item" href="/installation.html">Installation</a>
    </li>
    <li class="site-menu-item site-menu-item-main">
     <a class="site-menu-item" href="/gallery.html">Gallery</a>
    </li>
    <li class="site-menu-item site-menu-item-main">API Documentation
     <div class="sub">
      <a class="site-menu-item" href="/doxygen_cxx/index.html">C++</a>
      <a class="site-menu-item" href="/pydrake/index.html">Python</a>
     </div>
    </li>
    <li class="site-menu-item site-menu-item-main">Resources
     <div class="sub">
      <a class="site-menu-item" href="/getting_help.html">Getting Help</a>
      <a class="site-menu-item" href="https://deepnote.com/workspace/Drake-0b3b2c53-a7ad-441b-80f8-bf8350752305/project/Tutorials-2b4fc509-aef2-417d-a40d-6071dfed9199/notebook/index-753e3c9d261247ba9f0eb1d7868c18c8">Tutorials</a>
      <a class="site-menu-item" href="/python_bindings.html">Python Bindings</a>
      <a class="site-menu-item" href="/developers.html">For Developers</a>
      <a class="site-menu-item" href="/credits.html">Credits</a>
     </div>
    </li>
    <li class="github-link">
     <a class="site-menu-item" href="https://github.com/RobotLocomotion/drake">GitHub <img src="/third_party/images/GitHub-Mark-Light-64px.png"></a>
    </li>
   </ul>
  </nav>
 </div>
</header>
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Drake
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<div class="title-banner">
 <div class="title-banner__title">
  Drake C++ Documentation
 </div>
 <div id="DDGSearch">
  <form id="search_form_cpp" class="wy_form" action="https://google.com/search" method="get">
   <input type="text" name="q" placeholder="Search C++ API only…">
   <input type="hidden" name="q" value="site:drake.mit.edu/doxygen_cxx">
  </form>
  <form id="search_form" class="wy_form" action="https://google.com/search" method="get">
   <input type="text" name="q" placeholder="Search all of Drake…">
   <input type="hidden" name="q" value="site:drake.mit.edu OR site:underactuated.csail.mit.edu OR site:manipulation.csail.mit.edu">
  </form>
 </div>
 <div id="MSearchBoxContainer">
  <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect" class="search-icon" onmouseover="return searchBox.OnSearchSelectShow()" onmouseout="return searchBox.OnSearchSelectHide()"><span class="search-icon-dropdown"></span></span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><div id="MSearchCloseImg" class="close-icon"></div></a>
          </span>
        </div>
</td>
 </div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('group__python__bindings.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">Python Bindings <div class="ingroups"><a class="el" href="group__technical__notes.html">Technical Notes</a></div></div></div>
</div><!--header-->
<div class="contents">
<p>Details on implementing python bindings for the C++ code. </p>
<h1>Overview</h1>
<p>Drake uses <a href="http://pybind11.readthedocs.io/en/stable/">pybind11</a> for binding its C++ API to Python.</p>
<p>At present, patches against <span class="tt">pybind11</span> are used which permit binding matrices with <span class="tt">dtype=object</span>, improve support for Python classes derived from C++ base classes, and check for errors that impact generated documentation.</p>
<p>Before delving too deep into this, please first review the user-facing documentation about <a href="https://drake.mit.edu/python_bindings.html#what-s-available-from-python">What's Available from Python</a>.</p>
<h2>Module Organization</h2>
<p>The structure of the bindings generally follow the <em>directory structure</em>, not the namespace structure. As an example, the following code in C++:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="parser_8h.html">drake/multibody/parsing/parser.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multibody__plant_8h.html">drake/multibody/plant/multibody_plant.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using </span><a class="code hl_class" href="classdrake_1_1multibody_1_1_multibody_plant.html">drake::multibody::MultibodyPlant</a>;</div>
<div class="line"><span class="keyword">using </span><a class="code hl_class" href="classdrake_1_1multibody_1_1_parser.html">drake::multibody::Parser</a>;</div>
<div class="ttc" id="aclassdrake_1_1multibody_1_1_multibody_plant_html"><div class="ttname"><a href="classdrake_1_1multibody_1_1_multibody_plant.html">drake::multibody::MultibodyPlant</a></div><div class="ttdoc">MultibodyPlant is a Drake system framework representation (see systems::System) for the model of a ph...</div><div class="ttdef"><b>Definition</b> multibody_plant.h:958</div></div>
<div class="ttc" id="aclassdrake_1_1multibody_1_1_parser_html"><div class="ttname"><a href="classdrake_1_1multibody_1_1_parser.html">drake::multibody::Parser</a></div><div class="ttdoc">Parses model description input into a MultibodyPlant and (optionally) a SceneGraph.</div><div class="ttdef"><b>Definition</b> parser.h:132</div></div>
<div class="ttc" id="amultibody__plant_8h_html"><div class="ttname"><a href="multibody__plant_8h.html">multibody_plant.h</a></div></div>
<div class="ttc" id="aparser_8h_html"><div class="ttname"><a href="parser_8h.html">parser.h</a></div></div>
</div><!-- fragment --><p>will look similar in Python, but you won't use the header file's name:</p>
<div class="fragment"><div class="line"><span class="keyword">from</span> pydrake.multibody.parsing <span class="keyword">import</span> Parser</div>
<div class="line"><span class="keyword">from</span> pydrake.multibody.plant <span class="keyword">import</span> MultibodyPlant</div>
</div><!-- fragment --><p>In general, you can find where a symbol is bound by searching for the symbol's name in quotes underneath the directory <span class="tt">drake/bindings/pydrake</span>.</p>
<p>For example, you should search for <span class="tt">"MultibodyPlant"</span>, <span class="tt">"Parser"</span>, etc. To elaborate, the binding of <span class="tt">Parser</span> is found in <span class="tt">.../pydrake/multibody/parsing_py.cc</span>, and looks like this:</p>
<div class="fragment"><div class="line"><span class="keyword">using </span>Class = Parser;</div>
<div class="line">py::class_&lt;Class&gt;(m, <span class="stringliteral">&quot;Parser&quot;</span>, ...)</div>
</div><!-- fragment --><p>and binding of <span class="tt">MultibodyPlant</span> template instantiations are in <span class="tt">.../pydrake/multibody/plant_py.cc</span> and look like this:</p>
<div class="fragment"><div class="line"><span class="keyword">using </span>Class = MultibodyPlant&lt;T&gt;;</div>
<div class="line">DefineTemplateClassWithDefault&lt;Class, systems::LeafSystem&lt;T&gt;&gt;(</div>
<div class="line">    m, <span class="stringliteral">&quot;MultibodyPlant&quot;</span>, ...)</div>
</div><!-- fragment --><p>where the function containing this definition is templated on type <span class="tt">T</span> and invoked for the scalar types mentioned in <span class="tt"><a class="el" href="default__scalars_8h.html">drake/common/default_scalars.h</a></span>.</p>
<p>Some (but not all) exceptions to the above rules:</p>
<ul>
<li><span class="tt"><a class="el" href="common_2autodiff_8h.html" title="This header provides a single inclusion point for autodiff-related header files in the drake/common d...">drake/common/autodiff.h</a></span> symbols live in <span class="tt">pydrake.autodiffutils</span>.</li>
<li><span class="tt">drake/common/symbolic.h</span> symbols live in <span class="tt">pydrake.symbolic</span>.</li>
<li><span class="tt"><a class="el" href="value_8h.html">drake/common/value.h</a></span> symbols live in <span class="tt">pydrake.common.value</span>.</li>
<li><span class="tt">drake/systems/framework/*.h</span> symbols live in <span class="tt">pydrake.systems.framework</span> (per the rule) and the bindings are ultimately linked via <span class="tt">pydrake/systems/framework_py.cc</span>, but for compilation speed the binding definitions themselves are split into <span class="tt">./framework_py_{semantics,<a class="el" href="group__systems.html">Modeling Dynamical Systems</a>,values}.cc</span>.</li>
</ul>
<h2><span class="tt">pybind11</span> Tips</h2>
<h3>Python Types</h3>
<p>Throughout the Drake code, Python types provided by <span class="tt">pybind11</span> are used, such as <span class="tt">py::handle</span>, <span class="tt">py::object</span>, <span class="tt">py::module</span>, <span class="tt">py::str</span>, <span class="tt">py::list</span>, etc. For an overview, see the <a href="http://pybind11.readthedocs.io/en/stable/reference.html">pybind11 reference</a>.</p>
<p>All of these are effectively thin wrappers around <span class="tt">PyObject*</span>, and thus can be cheaply copied.</p>
<p>Mutating the referred-to object also does not require passing by reference, so you can always pass the object by value for functions, but you should document your method if it mutates the object in a non-obvious fashion.</p>
<h3>Python Type Conversions</h3>
<p>You can implicitly convert between <span class="tt">py::object</span> and its derived classes (such as <span class="tt">py::list</span>, <span class="tt">py::class_</span>, etc.), assuming the actual Python types agree. You may also implicitly convert from <span class="tt">py::object</span> (and its derived classes) to <span class="tt">py::handle</span>.</p>
<p>If you wish to convert a <span class="tt">py::handle</span> (or <span class="tt">PyObject*</span>) to <span class="tt">py::object</span> or a derived class, you should use <a href="http://pybind11.readthedocs.io/en/stable/reference.html#_CPPv218reinterpret_borrow6handle"><span class="tt">py::reinterpret_borrow&lt;&gt;</span></a>.</p>
<h1>Conventions</h1>
<h2>API</h2>
<p>Any Python bindings of C++ code will maintain C++ naming conventions, as well as Python code that is directly related to C++ symbols (e.g. shims, wrappers, or extensions on existing bound classes).</p>
<p>All other Python code be Pythonic and use PEP 8 naming conventions.</p>
<p>For binding functions or methods, argument names should be provided that correspond exactly to the C++ signatures using <span class="tt">py::arg("arg_name")</span>. This permits the C++ documentation to be relevant to the Sphinx-generated <a class="el" href="#PydrakeDoc">documentation</a>, and allows for the keyword-arguments to be used in Python.</p>
<p>For binding functions, methods, properties, and classes, docstrings should be provided. These should be provided as described <a class="el" href="#PydrakeDoc">here</a>.</p>
<h2>Testing</h2>
<p>In general, since the Python bindings wrap tested C++ code, you do not (and should not) repeat intricate testing logic done in C++. Instead, ensure you exercise the Pythonic portion of the API, using kwargs when appropriate.</p>
<p>When testing the values of NumPy matrices, please review the documentation in <span class="tt">pydrake.common.test_utilities.numpy_compare</span> for guidance.</p>
<h2>Target Conventions</h2>
<h3>Names</h3>
<ul>
<li><span class="tt">*_py</span>: A Python library (can be pure Python or pybind)<ul>
<li>File Names: <span class="tt">*.py</span>, <span class="tt">*_py.cc</span><ul>
<li>Each <span class="tt">*_py.cc</span> file should only define one package (a module; optionally with multiple submodules under it).</li>
</ul>
</li>
</ul>
</li>
<li><span class="tt">*_pybind</span>: A C++ library for adding pybind-specific utilities to be consumed by C++.<ul>
<li>File Names: <span class="tt">*_pybind.{h,cc}</span></li>
</ul>
</li>
</ul>
<p>File names should follow form with their respective target.</p>
<h3>Visibility</h3>
<ul>
<li>All Python libraries should generally be private, as <span class="tt">pydrake</span> will be consumed as one encapsulated target.</li>
<li>All C++ <span class="tt">*_pybind</span> libraries for binding utilities should be public to aide downstream Bazel projects. If the API is unstable, consider making it private with a TODO to make public once it stabilizes.</li>
</ul>
<h3>Bazel</h3>
<p>Given that <span class="tt">libdrake.so</span> relies on static linking for components, any common headers should be robust against ODR violations. This can be normally achieved by using header-only libraries.</p>
<p>For upstream dependencies of these libraries, do NOT depend on the direct targets (e.g. <span class="tt">//common:essential</span>), because this will introduce runtime ODR violations for objects that have static storage (UID counters, etc.).</p>
<p>Instead, you must temporarily violate IWYU because it will be satisfied by <span class="tt">drake_pybind_library</span>, which will incorporate <span class="tt">libdrake.so</span> and the transitive headers.</p>
<p>If singletons are required (e.g. for <span class="tt">util/cpp_param_pybind</span>), consider storing the singleton values using Python.</p>
<p>If you are developing bindings for a small portion of Drake and would like to avoid rebuilding a large number of components when testing, consider editing <span class="tt">//tools/install/libdrake:build_components.bzl</span> to reduce the number of components being built.</p>
<p><a class="anchor" id="PydrakeModuleDefinitions"></a></p><h2>pybind Module Definitions</h2>
<ul>
<li>Module bindings must always be split into parts (to avoid large files that would bloat our compile times). The easiest way to understand this pattern is probably to look at an existing module that follows the convention (e.g., <span class="tt">pydrake/geometry/**</span> or <span class="tt">pydrake/visualization/**</span>), but here's a summary of the rules:<ul>
<li>foo_py.h: provides function signatures for the various "Define..." helper functions that comprise the module. In general, splitting into more (smaller) helper functions is better than fewer (larger) helper functions.</li>
<li>foo_py.cc: uses PYBIND11_MODULE to define the package or module, by importing other dependent modules, calling the "Define..." helper functions, and possibly defining submodules. Must not itself add bindings; it must always call helpers that add them.</li>
<li>foo_py_bar.cc: the definition for the "DefineBar" helper function.</li>
<li>foo_py_quux.cc: the definition for the "DefineQuux" helper function.</li>
<li>... etc.</li>
</ul>
</li>
<li>Modules should be defined within the drake::pydrake namespace. Please review this namespace for available helper methods / classes.</li>
<li>Any Drake pybind module should include <span class="tt">pydrake_pybind.h</span>.</li>
<li><span class="tt">PYBIND_MODULE</span> should be used to define modules.</li>
<li>The alias <span class="tt">namespace py = pybind11</span> is defined as <span class="tt">drake::pydrake::py</span>. Drake modules should not re-define this alias at global scope.</li>
<li>If a certain namespace is being bound (e.g. <span class="tt"><a class="el" href="namespacedrake_1_1systems_1_1sensors.html">drake::systems::sensors</a></span>), you may use <span class="tt">using namespace <a class="el" href="namespacedrake_1_1systems_1_1sensors.html">drake::systems::sensors</a></span> within functions or anonymous namespaces. Avoid <span class="tt">using namespace</span> directives otherwise.</li>
<li>Any symbol referenced in a module binding (even as function/method parameters) must either be <em>bound</em> in that compilation unit (with the binding evaluated before to the reference), or the module must import the pydrake module in which it is bound (e.g., <span class="tt">py::module::import("pydrake.foo"))</span>). Failure to do so can cause errors (unable to cast unregistered types from Python to C++) and can cause the generated docstring from pybind11 to render these types by their C++ <span class="tt">typeid</span> rather than the Python type name.</li>
<li>If a module depends on the <em>bindings</em> for another module, then you should do the following:<ul>
<li>Ensure that the dependent bindings module is listed in the <span class="tt">py_deps</span> attribute for the <span class="tt">drake_pybind_library()</span> target.</li>
<li>Inside the <span class="tt">_py.cc</span>, ensure that you tell Python to import dependency bindings. This is important to load the bindings at the right time (for documentation), and ensure the dependent bindings are executed so that users can import that module in isolation and still have it work. This is important when your type signatures use dependency bindings, or a class declares its inheritance, etc.</li>
<li>As an example: <pre class="fragment"># .../my_component.h
#include "drake/geometry/meshcat.h"
void MyMethod(std::shared_ptr&lt;Meshcat&gt; meshcat);

# bindings/.../BUILD.bazel
drake_pybind_library(
    name = "my_method_py",
    ...
    py_deps = [
        ...
        "//bindings/pydrake/geometry",
    ],
    ...
)

# bindings/.../my_method_py.cc
PYBIND_MODULE(my_method, m) {
  py::module::import("pydrake.geometry");
  m.def("MyMethod", &amp;MyMethod, ...);
}
</pre></li>
</ul>
</li>
</ul>
<p><a class="anchor" id="PydrakeDoc"></a></p><h2>Documentation</h2>
<p>Drake uses a modified version of <span class="tt">mkdoc.py</span> from <span class="tt">pybind11</span>, where <span class="tt">libclang</span> Python bindings are used to generate C++ docstrings accessible to the C++ binding code.</p>
<p>These docstrings are available within nested <span class="tt">constexpr struct</span> trees as <span class="tt">const char*</span> values. When these are not available or not suitable for Python documentation, provide custom strings. If this custom string is long, consider placing them in a heredoc string.</p>
<p>An example of incorporating docstrings:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;drake/bindings/generated_docstrings/math.h&quot;</span></div>
<div class="line"> </div>
<div class="line">PYBIND11_MODULE(math, m) {</div>
<div class="line">  <span class="keyword">using namespace </span><a class="code hl_namespace" href="namespacedrake_1_1math.html">drake::math</a>;</div>
<div class="line">  <span class="keyword">constexpr</span> <span class="keyword">auto</span>&amp; doc = pydrake_doc_math.drake.math;</div>
<div class="line">  <span class="keyword">using </span>T = double;</div>
<div class="line">  py::class_&lt;RigidTransform&lt;T&gt;&gt;(m, <span class="stringliteral">&quot;RigidTransform&quot;</span>, doc.RigidTransform.doc)</div>
<div class="line">      .def(py::init(), doc.RigidTransform.ctor.doc_0args)</div>
<div class="line">      ...</div>
<div class="line">      .def(py::init&lt;<span class="keyword">const</span> <a class="code hl_class" href="classdrake_1_1math_1_1_rotation_matrix.html">RotationMatrix&lt;T&gt;</a>&amp;&gt;(), py::arg(<span class="stringliteral">&quot;R&quot;</span>),</div>
<div class="line">          doc.RigidTransform.ctor.doc_1args_R)</div>
<div class="line">      .def(py::init&lt;<span class="keyword">const</span> Eigen::Quaternion&lt;T&gt;&amp;, <span class="keyword">const</span> <a class="code hl_typedef" href="namespacedrake.html#a0ad29daab565ce347c4d1c5aae6a76c2">Vector3&lt;T&gt;</a>&amp;&gt;(),</div>
<div class="line">          py::arg(<span class="stringliteral">&quot;quaternion&quot;</span>), py::arg(<span class="stringliteral">&quot;p&quot;</span>),</div>
<div class="line">          doc.RigidTransform.ctor.doc_2args_quaternion_p)</div>
<div class="line">      ...</div>
<div class="line">      .def(<span class="stringliteral">&quot;set_rotation&quot;</span>, &amp;<a class="code hl_function" href="classdrake_1_1math_1_1_rigid_transform.html#a3e953a8287f40248d4d2c1030ef72cef">RigidTransform&lt;T&gt;::set_rotation</a>, py::arg(<span class="stringliteral">&quot;R&quot;</span>),</div>
<div class="line">          doc.RigidTransform.set_rotation.doc)</div>
<div class="line">  ...</div>
<div class="line">}</div>
<div class="ttc" id="aclassdrake_1_1math_1_1_rigid_transform_html_a3e953a8287f40248d4d2c1030ef72cef"><div class="ttname"><a href="classdrake_1_1math_1_1_rigid_transform.html#a3e953a8287f40248d4d2c1030ef72cef">drake::math::RigidTransform::set_rotation</a></div><div class="ttdeci">void set_rotation(const RotationMatrix&lt; T &gt; &amp;R)</div><div class="ttdoc">Sets the RotationMatrix portion of this RigidTransform.</div><div class="ttdef"><b>Definition</b> rigid_transform.h:611</div></div>
<div class="ttc" id="aclassdrake_1_1math_1_1_rotation_matrix_html"><div class="ttname"><a href="classdrake_1_1math_1_1_rotation_matrix.html">drake::math::RotationMatrix</a></div><div class="ttdoc">This class represents a 3x3 rotation matrix between two arbitrary frames A and B and helps ensure use...</div><div class="ttdef"><b>Definition</b> rotation_matrix.h:57</div></div>
<div class="ttc" id="anamespacedrake_1_1math_html"><div class="ttname"><a href="namespacedrake_1_1math.html">drake::math</a></div><div class="ttdef"><b>Definition</b> autodiff.h:24</div></div>
<div class="ttc" id="anamespacedrake_html_a0ad29daab565ce347c4d1c5aae6a76c2"><div class="ttname"><a href="namespacedrake.html#a0ad29daab565ce347c4d1c5aae6a76c2">drake::Vector3</a></div><div class="ttdeci">Eigen::Matrix&lt; Scalar, 3, 1 &gt; Vector3</div><div class="ttdoc">A column vector of size 3, templated on scalar type.</div><div class="ttdef"><b>Definition</b> eigen_types.h:48</div></div>
</div><!-- fragment --><p>An example of supplying custom strings:</p>
<div class="fragment"><div class="line"><span class="keyword">constexpr</span> <span class="keywordtype">char</span> another_helper_doc[] = R<span class="stringliteral">&quot;&quot;&quot;(</span></div>
<div class="line"><span class="stringliteral">Another helper docstring. This is really long.</span></div>
<div class="line"><span class="stringliteral">And has multiple lines.</span></div>
<div class="line"><span class="stringliteral">)&quot;&quot;&quot;;</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">PYBIND11_MODULE(example, m) {</span></div>
<div class="line"><span class="stringliteral">  m.def(</span><span class="stringliteral">&quot;helper&quot;</span>, []() { <span class="keywordflow">return</span> 42; }, <span class="stringliteral">&quot;My helper method&quot;</span>);</div>
<div class="line">  m.def(<span class="stringliteral">&quot;another_helper&quot;</span>, []() { <span class="keywordflow">return</span> 10; }, another_helper_doc);</div>
<div class="line">}</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>Consider using scoped aliases to abbreviate both the usage of bound types and the docstring structures. Borrowing from above:</dd></dl>
<div class="fragment"><div class="line">{</div>
<div class="line">  <span class="keyword">using </span>Class = <a class="code hl_class" href="classdrake_1_1math_1_1_rigid_transform.html">RigidTransform&lt;T&gt;</a>;</div>
<div class="line">  <span class="keyword">constexpr</span> <span class="keyword">auto</span>&amp; cls_doc = doc.<a class="code hl_friend" href="classdrake_1_1math_1_1_rigid_transform.html#a8bedd8c483aaf5bc48587d10d7a3d485">RigidTransform</a>;</div>
<div class="line">  py::class_&lt;Class&gt;(m, <span class="stringliteral">&quot;RigidTransform&quot;</span>, cls_doc.doc)</div>
<div class="line">      .def(py::init(), cls_doc.ctor.doc_0args)</div>
<div class="line">      ...</div>
<div class="line">}</div>
<div class="ttc" id="aclassdrake_1_1math_1_1_rigid_transform_html"><div class="ttname"><a href="classdrake_1_1math_1_1_rigid_transform.html">drake::math::RigidTransform</a></div><div class="ttdoc">This class represents a proper rigid transform between two frames which can be regarded in two ways.</div><div class="ttdef"><b>Definition</b> rigid_transform.h:73</div></div>
<div class="ttc" id="aclassdrake_1_1math_1_1_rigid_transform_html_a8bedd8c483aaf5bc48587d10d7a3d485"><div class="ttname"><a href="classdrake_1_1math_1_1_rigid_transform.html#a8bedd8c483aaf5bc48587d10d7a3d485">drake::math::RigidTransform::RigidTransform</a></div><div class="ttdeci">friend class RigidTransform</div><div class="ttdef"><b>Definition</b> rigid_transform.h:941</div></div>
</div><!-- fragment --><p>To view the documentation rendered in Sphinx: </p><pre class="fragment">bazel run -- //doc/pydrake:build --serve [--browser=false]
</pre><dl class="section note"><dt>Note</dt><dd>Drake's online Python documentation is generated on Ubuntu Noble, and it is suggested to preview documentation using this platform. Other platforms may have slightly different generated documentation.</dd></dl>
<p>To browse the generated documentation strings that are available for use (or especially, to find out the names for overloaded functions' documentation), re-generate and open the docstring header: </p><pre class="fragment">bazel run //bindings/generated_docstrings:regenerate
$EDITOR bazel-bin/bindings/generated_docstrings/SOME_FILE.h
</pre><p>Search the comments for the symbol of interest, e.g., <span class="tt"><a class="el" href="classdrake_1_1math_1_1_rigid_transform.html#a8bedd8c483aaf5bc48587d10d7a3d485">drake::math::RigidTransform::RigidTransform</a>&lt;T&gt;</span>, and view the include file and line corresponding to the symbol that the docstring was pulled from.</p>
<dl class="section note"><dt>Note</dt><dd>This file may be large, on the order of ~10K lines; be sure to use an efficient editor!</dd></dl>
<p>For more detail:</p>
<ul>
<li>Docstrings are stored in files named after the subdirectory where the original C++ header file lives, e.g., <span class="tt"><a class="el" href="multibody__tree_8h.html">multibody_tree.h</a></span> for <span class="tt">drake/multibody/tree</span> docs.</li>
<li>The constants sit within structures named <span class="tt">pydrake_doc_{directory_names}</span>, e.g., <span class="tt">pydrake_doc_multibody_tree</span> for <span class="tt">drake/multibody/tree</span> docs.</li>
<li>The docstring for a symbol without any overloads will be accessible via <span class="tt">pydrake_doc_{directory_names}.<a class="el" href="namespacedrake.html">drake</a>.{namespace...}.{symbol}.doc</span>.</li>
<li>The docstring for an overloaded symbol will be <span class="tt">.doc_something</span> instead of just <span class="tt">.doc</span>, where the <span class="tt">_something</span> suffix conveys some information about the overload. Browse the documentation_pybind.h (described above) for details. Most commonly, the names will be <span class="tt">doc_1args</span>, <span class="tt">doc_3args</span>, etc. Be sure that the pydrake binding's signature is consistent with the docstring argument count.</li>
<li>If two or more docstrings are the same, only one new symbol is introduced.</li>
<li>To suppress a Doxygen comment from mkdoc, add the custom Doxygen command <code>@exclude_from_pydrake_mkdoc{Explanation}</code> to the API comment text. This is useful to help dismiss unbound overloads, so that mkdoc's choice of <span class="tt">_something</span> name suffix is simpler for the remaining overloads, especially if you see the symbol <span class="tt">.doc_was_unable_to_choose_unambiguous_names</span> in the generated documentation.</li>
<li>To manually specify the <span class="tt">.doc_foobar</span> identifier name, add the line <code>@pydrake_mkdoc_identifier{foobar}</code> to the Doxygen comment.</li>
<li>The docstring for a method that is marked as deprecated in C++ Doxygen will be named <span class="tt">.doc_deprecated...</span> instead of just <span class="tt">.doc...</span>.</li>
</ul>
<p><a class="anchor" id="PydrakeDeprecation"></a></p><h2>Deprecation</h2>
<p>Decorators and utilities for deprecation in pure Python are available in <a href="https://drake.mit.edu/pydrake/pydrake.common.deprecation.html"><span class="tt">pydrake.common.deprecation</span></a>.</p>
<p>Deprecations for Python bindings in C++ are available in <a href="https://drake.mit.edu/doxygen_cxx/deprecation__pybind_8h.html"><span class="tt">drake/bindings/pydrake/common/deprecation_pybind.h</span></a>.</p>
<p>For examples of how to use the deprecations and what side effects they will have, please see:</p>
<ul>
<li><a href="https://github.com/RobotLocomotion/drake/tree/master/bindings/pydrake/common/test/deprecation_example"><span class="tt">drake/bindings/.../deprecation_example/</span></a></li>
<li><a href="https://github.com/RobotLocomotion/drake/blob/master/bindings/pydrake/common/test/deprecation_utility_test.py"><span class="tt">drake/bindings/.../deprecation_utility_test.py</span></a></li>
</ul>
<dl class="section note"><dt>Note</dt><dd>All deprecations in Drake should ultimately use the <a href="https://docs.python.org/3.6/library/warnings.html">Python <span class="tt">warnings</span> module</a>, and the <a href="https://drake.mit.edu/pydrake/pydrake.common.deprecation.html#pydrake.common.deprecation.DrakeDeprecationWarning"><span class="tt">DrakeDeprecationWarning</span></a> class. The utilities mentioned above use them.</dd></dl>
<p><a class="anchor" id="PydrakeKeepAlive"></a></p><h2>Keep Alive Behavior</h2>
<p><span class="tt">py::keep_alive&lt;Nurse, Patient&gt;()</span> is used heavily throughout this code. Please first review <a href="http://pybind11.readthedocs.io/en/stable/advanced/functions.html#keep-alive">the pybind11 documentation</a>.</p>
<p><span class="tt">py::keep_alive</span> decorations should be added after all <span class="tt">py::arg</span>s are specified. Terse comments should be added above these decorations to indicate the relationship between the Nurse and the Patient and decode the meaning of the Nurse and Patient integers by spelling out either the <span class="tt">py::arg</span> name (for named arguments), <span class="tt">return</span> for index 0, or <span class="tt">self</span> (not <span class="tt">this</span>) for index 1 when dealing with methods / members. The primary relationships:</p><ul>
<li>"Keep alive, ownership" implies that a Patient owns the Nurse (or vice versa).</li>
<li>"Keep alive, reference" implies a Patient that is referred to by the Nurse.</li>
</ul>
<p>If there is an indirect / transitive relationship (storing a reference to an argument's member or a transfer of ownership, append <span class="tt">(tr.)</span> to the relationship. Note: ownership transfer solutions likely require treatment of all the involved objects; see <a class="el" href="#PydrakeRefCycle">Using pydrake::internal::ref_cycle</a> and <a href="https://github.com/RobotLocomotion/drake/issues/14387">issue #14387</a>.</p>
<p>Some example comments:</p>
<div class="fragment"><div class="line"><span class="comment">// Keep alive, reference: `self` keeps `context` alive.</span></div>
<div class="line"><span class="comment">// Keep alive, ownership (tr.): `return` keeps `self` alive.</span></div>
</div><!-- fragment --><dl class="section warning"><dt>Warning</dt><dd>Keep-alives hold Python references in a way that cannot be found by Python garbage collection. Any reference cycle made of keep-alives will make all of the objects involved immortal. That is, their memory will be leaked for the entire lifetime of the process. For complicated situations involving object structures that are logically cyclic, ownership transfer in C++, etc., see <a class="el" href="#PydrakeRefCycle">Using pydrake::internal::ref_cycle</a>.</dd></dl>
<p><a class="anchor" id="PydrakeReturnValuePolicy"></a></p><h2>Return Value Policy</h2>
<p>For more information about <span class="tt">pybind11</span> return value policies, see <a href="https://pybind11.readthedocs.io/en/stable/advanced/functions.html#return-value-policies">the pybind11 documentation</a>.</p>
<p><span class="tt">pydrake</span> offers the <span class="tt">drake::pydrake::py_rvp</span> alias to help with shortened usage of <span class="tt">py::return_value_policy</span>. The most used (non-default) policies in <span class="tt">pydrake</span> are <span class="tt">reference</span> and <span class="tt">reference_internal</span> due to the usage of raw pointers / references in the public C++ API (rather than <span class="tt">std::shared_ptr&lt;&gt;</span>).</p>
<dl class="section note"><dt>Note</dt><dd>While <span class="tt">py_rvp::reference_internal</span> effectively implies <span class="tt">py_rvp::reference</span> and <span class="tt">py::keep_alive&lt;0, 1&gt;()</span>, we choose to only use it when <span class="tt">self</span> is the intended patient (i.e. the bound item is a class method). For static / free functions, we instead explicitly spell out <span class="tt">py_rvp::reference</span> and <span class="tt">py::keep_alive&lt;0, 1&gt;()</span>.</dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>Use of <span class="tt">py_rvp::reference_internal</span> can contribute to memory leaks if a returned object is stored in memory controlled by the lifetime of the Patient. For a full discussion, see <a class="el" href="#PydrakeRefCycle">Using pydrake::internal::ref_cycle</a>.</dd></dl>
<p><a class="anchor" id="PydrakeRefCycle"></a></p><h2>Using pydrake::internal::ref_cycle</h2>
<p>For complicated lifetime management situations, <span class="tt">pydrake</span> itself provides <span class="tt">internal::ref_cycle&lt;&gt;()</span>. It creates a bidirectional cycle between two objects that is garbage collectible. It has two prerequisites:</p>
<ul>
<li>include <span class="tt">drake/bindings/pydrake/common/ref_cycle_pybind.h</span></li>
<li>ensure that both objects have <span class="tt">py::dynamic_attr()</span> in their class definition</li>
</ul>
<p>If those prerequisites can be met, then <span class="tt">ref_cycle</span> is a drop-in replacement for <span class="tt">keep_alive</span> that is guaranteed not to cause permanent memory leaks. Note that the cycle will remain alive as long as either object is reachable from a live python variable. Once the cycle is not reachable, it will be deleted at the next automatic garbage collection, or when <span class="tt">gc.collect()</span> is invoked explicitly.</p>
<p>The <span class="tt">ref_cycle</span> annotation has been helpful in solving some tricky lifetime problems with pydrake bindings. It was one piece of the solution to Diagram memory leaks; see <a href="https://github.com/RobotLocomotion/drake/issues/14387">issue #14387</a> for details. In the case of Python custom leaf systems, it was used to avoid inadvertent self-reference via stored references to port objects. See <a href="https://github.com/RobotLocomotion/drake/issues/22515">issue #22515</a> for details.</p>
<p>A fairly simple example of using <span class="tt">ref_cycle</span> might look like the code below. The code is excerpted from fixes to <a href="https://github.com/RobotLocomotion/drake/issues/22515">issue #22515</a>:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;drake/bindings/pydrake/common/ref_cycle_pybind.h&quot;</span></div>
<div class="line">...</div>
<div class="line">    <span class="keyword">auto</span> system_cls =</div>
<div class="line">        DefineTemplateClassWithDefault&lt;System&lt;T&gt;, SystemBase, PySystem&gt;(m,</div>
<div class="line">            <span class="stringliteral">&quot;System&quot;</span>, GetPyParam&lt;T&gt;(), doc.System.doc, std::nullopt,</div>
<div class="line">            py::dynamic_attr());</div>
<div class="line">...</div>
<div class="line">        <span class="comment">// Port access methods. All returned port references use a ref_cycle</span></div>
<div class="line">        <span class="comment">// (rather than the implicit keep-alive of reference_internal) to avoid</span></div>
<div class="line">        <span class="comment">// immortality hazards like #22515.</span></div>
<div class="line">        .def(<span class="stringliteral">&quot;get_input_port&quot;</span>,</div>
<div class="line">            overload_cast_explicit&lt;<span class="keyword">const</span> InputPort&lt;T&gt;&amp;, <span class="keywordtype">int</span>, <span class="keywordtype">bool</span>&gt;(</div>
<div class="line">                &amp;System&lt;T&gt;::get_input_port),</div>
<div class="line">            internal::ref_cycle&lt;0, 1&gt;(), py_rvp::reference,</div>
<div class="line">            py::arg(<span class="stringliteral">&quot;port_index&quot;</span>), py::arg(<span class="stringliteral">&quot;warn_deprecated&quot;</span>) = <span class="keyword">true</span>,</div>
<div class="line">            doc.System.get_input_port.doc_2args)</div>
</div><!-- fragment --><p>Notice that in replacing <span class="tt">py_rvp::reference_internal</span>, we need both the <span class="tt">ref_cycle</span> (to manage lifetimes in lieu of the implicit keep-alive) and <span class="tt">py_rvp::reference</span> (to avoid copying).</p>
<p><a class="anchor" id="PydrakeOverloads"></a></p><h2>Function Overloads</h2>
<p>To bind function overloads, please try the following (in order):</p><ul>
<li><span class="tt">py::overload_cast&lt;Args&gt;(func)</span>: See <a href="http://pybind11.readthedocs.io/en/stable/classes.html#overloaded-methods">the pybind11 documentation</a>. This works about 80% of the time.</li>
<li><span class="tt">pydrake::overload_cast_explicit&lt;Return, Args...&gt;(func)</span>: When <span class="tt">py::overload_cast</span> does not work (not always guaranteed to work).</li>
<li><span class="tt">static_cast</span>, as mentioned in the pybind11 documentation.</li>
<li>Lambdas, e.g. <span class="tt">[](Args... args) -&gt; auto&amp;&amp; { return func(args...); }</span> (using perfect forwarding when appropriate).</li>
</ul>
<h3>Mutable vs. <span class="tt">const</span> Method Overloads</h3>
<p>C++ has the ability to distinguish <span class="tt">T</span> and <span class="tt">const T</span> for both function arguments and class methods. However, Python does not have a native mechanism for this. It is possible to provide a feature like this in Python (see discussion and prototypes in <a href="https://github.com/RobotLocomotion/drake/issues/7793">#7793</a>); however, its pros (similarity to C++) have not yet outweighed the cons (awkward non-Pythonic types and workflows).</p>
<p>When a function is overloaded only by its <span class="tt">const</span>-ness, choose to bind the mutable overload, not the <span class="tt">const</span> overload.</p>
<p>We do this because <span class="tt">pybind11</span> evaluates overloads in the order they are bound, and is not possible for a user to "reach" any overloads that can only be disambiguated by const-ness.</p>
<p>Examples of functions to bind and not bind:</p>
<div class="fragment"><div class="line"><span class="comment">// N.B. The two free functions below aren&#39;t necessarily great in terms of coding</span></div>
<div class="line"><span class="comment">// and the GSG; however, we use them for illustrative purposes.</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// BIND: Should be exposed.</span></div>
<div class="line"><span class="keywordtype">void</span> MyFunction(MyClass* mutable_value);</div>
<div class="line"><span class="comment">// DO NOT BIND: Identical to above mutable overload, may constrain user.</span></div>
<div class="line"><span class="keywordtype">void</span> MyFunction(<span class="keyword">const</span> MyClass&amp; value);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Disambiguating an accessor solely based on `const`-ness of `this`. In</span></div>
<div class="line"><span class="comment">// general, you may want to avoid this.</span></div>
<div class="line"><span class="keyword">class </span>MyOtherClassDispreferred {</div>
<div class="line"> <span class="keyword">public</span>:</div>
<div class="line">  ...</div>
<div class="line">  <span class="comment">// BIND: Even though more costly, this ensure the user has access to the</span></div>
<div class="line">  <span class="comment">// &quot;maximum&quot; amount of functionality.</span></div>
<div class="line">  MyClass&amp; value();</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// DO NOT BIND: Identical to above mutable overload.</span></div>
<div class="line">  <span class="keyword">const</span> MyClass&amp; value() <span class="keyword">const</span>;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>MyOtherClassPreferred {</div>
<div class="line"> <span class="keyword">public</span>:</div>
<div class="line">  ...</div>
<div class="line">  <span class="comment">// BIND: Unambiguous.</span></div>
<div class="line">  MyClass&amp; mutable_value();</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// BIND: Unambiguous.</span></div>
<div class="line">  <span class="keyword">const</span> MyValue&amp; value() <span class="keyword">const</span>;</div>
<div class="line">};</div>
</div><!-- fragment --><h3>Public C++ API Considerations for Function and Method Templates</h3>
<p>The motivation behind this section can be found under the "C++ Function and Method Template Instantiations in Python" section in <span class="tt">doc/python_bindings.rst</span>.</p>
<p>In general, Drake uses techniques like parameter packs and type erasure to create sugar functions. These functions map their inputs to parameters of some concrete, under-the-hood method that actually does the work, and is devoid of such tricks. To facilitate python bindings, this underlying function should also be exposed in the public API.</p>
<p>As an example for parameter packs, <span class="tt">MultibodyPlant&lt;T&gt;::AddJoint&lt;JointType, Args...&gt;(...)</span> (<a href="https://git.io/JfqhI">code permalink</a>) is a C++ sugar method that uses parameter packs and ultimately passes the result to <span class="tt">MultibodyPlant&lt;T&gt;::AddJoint&lt;JointType&gt;(unique_ptr&lt;JointType&gt;)</span> (<a href="https://git.io/JfqhU">code permalink</a>), and only the <span class="tt">unique_ptr</span> function is bound (<a href="https://git.io/Jfqie">code permalink</a>):</p>
<div class="fragment"><div class="line"><span class="keyword">using </span>Class = MultibodyPlant&lt;T&gt;;</div>
<div class="line">...</div>
<div class="line">    .def(<span class="stringliteral">&quot;AddJoint&quot;</span>,</div>
<div class="line">        [](Class* self, std::unique_ptr&lt;Joint&lt;T&gt;&gt; joint) -&gt; <span class="keyword">auto</span>&amp; {</div>
<div class="line">          <span class="keywordflow">return</span> self-&gt;AddJoint(std::move(joint));</div>
<div class="line">        },</div>
<div class="line">        py::arg(<span class="stringliteral">&quot;joint&quot;</span>), py_rvp::reference_internal, cls_doc.AddJoint.doc_1args)</div>
<div class="line">...</div>
</div><!-- fragment --><p>As an example for parameter packs, <span class="tt">GeometryProperties::AddProperty&lt;ValueType&gt;</span> (<a href="https://git.io/JfqhL">code permalink</a>) is a C++ sugar method that uses type erasure and ultimately passes the result to <span class="tt">GeometryProperties::AddPropertyAbstract</span> (<a href="https://git.io/Jfqhm">code permalink</a>), and only the <span class="tt">AddPropertyAbstract</span> flavor is used in the bindings, but in such a way that it is similar to the C++ API for <span class="tt">AddProperty</span> (<a href="https://git.io/JfqiT">code permalink</a>):</p>
<div class="fragment"><div class="line"><span class="keyword">using </span>Class = GeometryProperties;</div>
<div class="line">py::handle abstract_value_cls =</div>
<div class="line">    py::module::import(<span class="stringliteral">&quot;pydrake.systems.framework&quot;</span>).attr(<span class="stringliteral">&quot;AbstractValue&quot;</span>);</div>
<div class="line">...</div>
<div class="line">    .def(<span class="stringliteral">&quot;AddProperty&quot;</span>,</div>
<div class="line">        [abstract_value_cls](Class* self, <span class="keyword">const</span> std::string&amp; group_name,</div>
<div class="line">            <span class="keyword">const</span> std::string&amp; name, py::object value) {</div>
<div class="line">          py::object abstract = abstract_value_cls.attr(<span class="stringliteral">&quot;Make&quot;</span>)(value);</div>
<div class="line">          self-&gt;AddPropertyAbstract(</div>
<div class="line">              group_name, name, abstract.cast&lt;<span class="keyword">const</span> AbstractValue&amp;&gt;());</div>
<div class="line">        },</div>
<div class="line">        py::arg(<span class="stringliteral">&quot;group_name&quot;</span>), py::arg(<span class="stringliteral">&quot;name&quot;</span>), py::arg(<span class="stringliteral">&quot;value&quot;</span>),</div>
<div class="line">        cls_doc.AddProperty.doc)</div>
<div class="line">...</div>
</div><!-- fragment --><h3>Matrix-multiplication-like Methods</h3>
<p>For objects that may be represented by matrices or vectors (e.g. RigidTransform, RotationMatrix), the <span class="tt">*</span> operator (via <span class="tt">__mul__</span>) should <em>not</em> be bound because the <span class="tt">*</span> operator in NumPy implies element-wise multiplication for arrays.</p>
<p>For simplicity, we instead bind the explicitly named <span class="tt">.multiply()</span> method, and alias the <span class="tt">__matmul__</span> operator <span class="tt">@</span> to this function.</p>
<h3>Clone Methods</h3>
<p>If you wish to bind a <span class="tt">Clone()</span> method, please use <span class="tt">DefClone()</span> so that <span class="tt">__copy__()</span> and <span class="tt">__deepcopy__()</span> will also be defined. (It is simplest to do these things together.)</p>
<p><a class="anchor" id="PydrakeReturnVectorsOrMatrices"></a></p><h4>Returning Vectors or Matrices</h4>
<p>Certain bound methods, like <span class="tt">RigidTransform.multiply()</span>, will have overloads that can multiply and return (a) other <span class="tt">RigidTransform</span> instances, (b) vectors, or (c) matrices (representing a list of vectors).</p>
<p>In the cases of (a) and (c), <span class="tt">pybind11</span> provides sufficient mechanisms to provide an unambiguous output return type. However, for (b), <span class="tt">pybind11</span> will return <span class="tt">ndarray</span> with shape <span class="tt">(3,)</span>. This can cause an issue when users pass a vector of shape <span class="tt">(3, 1)</span> as input. Nominally, pybind11 will return a <span class="tt">(3,)</span> array, but the user may expect <span class="tt">(3, 1)</span> as an output. To accommodate this, you should use the drake::pydrake::WrapToMatchInputShape function.</p>
<dl class="section see"><dt>See also</dt><dd><a href="https://github.com/RobotLocomotion/drake/issues/13885">https://github.com/RobotLocomotion/drake/issues/13885</a></dd></dl>
<h2>Python Subclassing of C++ Classes</h2>
<p>In general, minimize the amount in which users may subclass C++ classes in Python. When you do wish to do this, ensure that you use a trampoline class in <span class="tt">pybind</span>.</p>
<p><a class="anchor" id="PydrakeBazelDebug"></a></p><h1>Interactive Debugging with Bazel</h1>
<p>If you are debugging a unit test, first try running the test with <span class="tt">--trace=user</span> to see where the code is failing. This should cover most cases where you need to debug C++ bits. Example: </p><pre class="fragment">bazel run //bindings/pydrake/systems:py/lifetime_test -- --trace=user
</pre><p>If you need to debug further while using Bazel, it is suggested to use <span class="tt">gdbserver</span> for simplicity. Example:</p>
<div class="fragment"><div class="line"><span class="preprocessor"># Terminal 1 - Host process.</span></div>
<div class="line">cd <a class="code hl_namespace" href="namespacedrake.html">drake</a></div>
<div class="line">bazel run -c dbg \</div>
<div class="line">    --run_under=<span class="stringliteral">&#39;gdbserver localhost:9999&#39;</span> \</div>
<div class="line">    <span class="comment">//bindings/pydrake/systems:py/lifetime_test -- \</span></div>
<div class="line"><span class="comment">    --trace=user</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># Terminal 2 - Client debugger.</span></div>
<div class="line">cd <a class="code hl_namespace" href="namespacedrake.html">drake</a></div>
<div class="line">gdb -ex <span class="stringliteral">&quot;dir ${PWD}/bazel-drake&quot;</span> \</div>
<div class="line">    -ex <span class="stringliteral">&quot;target remote localhost:9999&quot;</span> \</div>
<div class="line">    -ex <span class="stringliteral">&quot;set sysroot&quot;</span> \</div>
<div class="line">    -ex <span class="stringliteral">&quot;set breakpoint pending on&quot;</span></div>
<div class="line"><span class="preprocessor"># In the GDB terminal:</span></div>
<div class="line">(gdb) <span class="keywordflow">break</span> <a class="code hl_function" href="classdrake_1_1systems_1_1_simulator.html#aa33b3ce4aeb5d29ac4a16de084bd307b">drake::systems::Simulator&lt;double&gt;::Simulator</a></div>
<div class="line">(gdb) <span class="keywordflow">continue</span></div>
<div class="ttc" id="aclassdrake_1_1systems_1_1_simulator_html_aa33b3ce4aeb5d29ac4a16de084bd307b"><div class="ttname"><a href="classdrake_1_1systems_1_1_simulator.html#aa33b3ce4aeb5d29ac4a16de084bd307b">drake::systems::Simulator::Simulator</a></div><div class="ttdeci">Simulator(const Simulator &amp;)=delete</div></div>
<div class="ttc" id="anamespacedrake_html"><div class="ttname"><a href="namespacedrake.html">drake</a></div><div class="ttdef"><b>Definition</b> auto_diff.h:9</div></div>
</div><!-- fragment --><p><span class="tt">set sysroot</span> is important for using <span class="tt">gdbserver</span>, <span class="tt">set breakpoint pending on</span> allows you set the breakpoints before loading <span class="tt">libdrake.so</span>, and <span class="tt">dir ...</span> adds source directories. It is also suggested that you <a href="https://stackoverflow.com/a/3176802">enable readline history</a> in <span class="tt">~/.gdbinit</span> for ease of use.</p>
<p>If using CLion, you can still connect to the <span class="tt">gdbserver</span> instance.</p>
<p>There are analogs for <span class="tt">lldb</span> / <span class="tt">lldbserver</span> but for brevity, only GDB is covered. </p>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- footer -->
<div class="navpath">
  <ul>
  </ul>
</div>
<footer id="nav-path", class="site-footer padding">
  <div class="contain">
    <a href="/" class="drake-logo">
      <img src="/images/drake-logo.svg"/>
    </a>
    <div class="footer-menu">
      <ul>    
        <li>
          <a href="/doxygen_cxx/index.html" class="site-menu-item">C++</a>
        </li>    
        <li>
          <a href="/pydrake/index.html" class="site-menu-item">Python</a>
        </li>
        <li class="github-link">
          <a href="https://github.com/RobotLocomotion/drake" class="site-menu-item">GitHub <img src="/third_party/images/GitHub-Mark-64px.png"/></a>
        </li>
      </ul>
    </div>
  </div>
</footer>
<script type="text/javascript">
searchBox.searchLabel = 'Go to name…';
searchBox.DOMSearchField().placeholder = searchBox.searchLabel;
searchBox.DOMSearchField().value = '';
</script>
</body>
</html>
