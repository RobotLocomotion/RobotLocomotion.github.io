<!-- HTML header for doxygen 1.8.15-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Drake: System Events</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_extra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<header class="site-header">
 <div class="site-header-inner contain">
  <a class="drake-logo" href="/"><img src="/images/drake-logo-white.svg"></a>
  <div class="menu-mobile-toggle">
   <span></span>
  </div>
  <nav class="site-menu">
   <ul>
    <li class="site-menu-item site-menu-item-main">
     <a class="site-menu-item" href="/">Home</a>
    </li>
    <li class="site-menu-item site-menu-item-main">
     <a class="site-menu-item" href="/installation.html">Installation</a>
    </li>
    <li class="site-menu-item site-menu-item-main">
     <a class="site-menu-item" href="/gallery.html">Gallery</a>
    </li>
    <li class="site-menu-item site-menu-item-main">API Documentation
     <div class="sub">
      <a class="site-menu-item" href="https://drake.mit.edu/doxygen_cxx/index.html">C++</a>
      <a class="site-menu-item" href="https://drake.mit.edu/pydrake/index.html">Python</a>
     </div>
    </li>
    <li class="site-menu-item site-menu-item-main">Resources
     <div class="sub">
      <a class="site-menu-item" href="/getting_help.html">Getting Help</a>
      <a class="site-menu-item" href="https://deepnote.com/workspace/Drake-0b3b2c53-a7ad-441b-80f8-bf8350752305/project/Tutorials-2b4fc509-aef2-417d-a40d-6071dfed9199/%2Findex.ipynb">Tutorials</a>
      <a class="site-menu-item" href="/python_bindings.html">Python Bindings</a>
      <a class="site-menu-item" href="/developers.html">For Developers</a>
      <a class="site-menu-item" href="/credits.html">Credits</a>
     </div>
    </li>
    <li class="github-link">
     <a class="site-menu-item" href="https://github.com/RobotLocomotion/drake">GitHub <img src="/third_party/images/GitHub-Mark-Light-64px.png"></a>
    </li>
   </ul>
  </nav>
 </div>
</header>
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Drake
   </div>
  </td>
 </tr>
 </tbody>
</table>
<div class="title-banner">
 <div class="title-banner__title">
  Drake C++ Documentation
 </div>
 <div id="DDGSearch">
  <form id="search_form_cpp" class="wy_form" action="https://google.com/search" method="get">
   <input type="text" name="q" placeholder="Search C++ API only…">
   <input type="hidden" name="q" value="site:drake.mit.edu/doxygen_cxx">
  </form>
  <form id="search_form" class="wy_form" action="https://google.com/search" method="get">
   <input type="text" name="q" placeholder="Search all of Drake…">
   <input type="hidden" name="q" value="site:drake.mit.edu OR site:underactuated.csail.mit.edu OR site:manipulation.csail.mit.edu">
  </form>
 </div>
 <div id="MSearchBoxContainer">
          <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
 </div>
</div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('group__events__description.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">System Events<div class="ingroups"><a class="el" href="group__systems.html">Modeling Dynamical Systems</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<p>This page describes how Drake Systems can respond (through an <a class="el" href="classdrake_1_1systems_1_1_event.html" title="Abstract base class that represents an event.">Event</a>) to changes ("triggers") in time, state, and inputs. </p>
<p>The state of simple dynamical systems, like the ODE ẋ = x, can be propagated through time using straightforward numerical integration. More sophisticated systems (e.g., systems modeled using piecewise differential algebraic equations, systems dependent upon mouse button clicks, and <a class="el" href="group__discrete__systems.html">Discrete Systems</a>) require more sophisticated state updating mechanisms. We call those state updates "events", the conditions that cause these events "triggers", and the mechanisms that compute the updates "handlers". We discuss these concepts in detail on this page. The <a class="el" href="classdrake_1_1systems_1_1_simulator.html" title="A class for advancing the state of hybrid dynamic systems, represented by System&lt;T&gt; objects,...">Simulator</a> class documentation describes the technical process underlying how events are handled in great detail.</p>
<h3>Exposition</h3>
<p>Events occur between discrete, finite advancements of systems' time and state. In the absence of events, a simulator would happily advance time and any continuous state without stopping. The occurrence of an event pauses the time and state evolution in order to allow a system to change its state discontinuously, to communicate with the "outside world", and even to just count the number of event occurrences.</p>
<h3>Types of events and triggers</h3>
<p>The diagram below distinguishes between the condition that is responsible for detecting the event (the "trigger") and the action that is taken when the event is dispatched (the "event handler"). </p><pre class="fragment">                           -- &gt; handler1
triggers  -- &gt;  dispatcher -- &gt; handler2
        Events             -- &gt; etc.
</pre><p>Handler actions fall into several categories based on event type, as described next.</p>
<h4>Event types</h4>
<p>Events are grouped by the component(s) of a system's <a class="el" href="classdrake_1_1systems_1_1_state.html" title="State is a container for all the data comprising the complete state of a particular System at a parti...">State</a> that can be altered:</p>
<ul>
<li>"publish" events can modify no state: they are useful for broadcasting data outside of the novel system and any containing diagrams, for terminating a simulation, for detecting errors, and for forcing boundaries between integration steps.</li>
<li>"discrete update" events can alter the discrete state of a system.</li>
<li>"unrestricted update" events can alter every component of state but time: continuous state, discrete state, and abstract state.</li>
</ul>
<p>Note that continuous state is nominally updated through the process of solving an ODE initial value problem (i.e., "integrating") rather than through a specialized event.</p>
<p>Updates are performed in a particular sequence. For example, unrestricted updates are performed before discrete updates. The <a class="el" href="classdrake_1_1systems_1_1_simulator.html" title="A class for advancing the state of hybrid dynamic systems, represented by System&lt;T&gt; objects,...">Simulator</a> documentation describes the precise update ordering.</p>
<h4>Event triggers</h4>
<p>Events can be triggered in various ways including:</p><ul>
<li>upon initialization</li>
<li>as a certain time is crossed (whether once or repeatedly, i.e., periodically)</li>
<li>per simulation step</li>
<li>as a <a class="el" href="classdrake_1_1systems_1_1_witness_function.html" title="Class that stores a function that is able to help determine the time and state at which a step of the...">WitnessFunction</a> crosses zero</li>
<li>"by force", e.g., the system's CalcUnrestrictedUpdate() function is invoked by some user code</li>
</ul>
<h3>How events are handled</h3>
<p><a class="el" href="classdrake_1_1systems_1_1_state.html" title="State is a container for all the data comprising the complete state of a particular System at a parti...">State</a> advances with time in dynamical systems. If the dynamical system is simulated, then Drake's <a class="el" href="classdrake_1_1systems_1_1_simulator.html" title="A class for advancing the state of hybrid dynamic systems, represented by System&lt;T&gt; objects,...">Simulator</a>, or another solver (see <a class="el" href="group__events__description.html#event_glossary">glossary</a>) is responsible for detecting when events trigger, dispatching the appropriate handler function, and updating the state as time advances. The update functions modify only copies of state so that every update function in a class (e.g., all unrestricted updates) sees the same pre-update state regardless of the sequence of event updates).</p>
<p>Events can also be dispatched manually ("by force"), i.e., outside of a solver. As noted above, one could call CalcUnrestrictedUpdate() to determine how a system's state would change and, optionally, update that state manually. Here is a simple example illustrating a forced publish: </p><div class="fragment"><div class="line">SystemX y;</div><div class="line">std::unique_ptr&lt;Context&lt;T&gt;&gt; context = y.CreateDefaultContext();</div><div class="line">y.Publish(*context);</div></div><!-- fragment --><h3>Information for leaf system authors</h3>
<h4>Declaring update functions</h4>
<p>The preferred way to update state through events is to declare an update handler in your LeafSystem-derived-class. Some older Drake code computes state updates by overriding event dispatchers (e.g., <a class="el" href="classdrake_1_1systems_1_1_leaf_system.html#adefdc7d9014d144812aecc5d66490a78" title="Derived-class event dispatcher for all simultaneous unrestricted update events.">LeafSystem::DoCalcUnrestrictedUpdate()</a>), <b>though that practice is discouraged and will soon be deprecated.</b></p>
<p>A number of convenience functions are available in <a class="el" href="classdrake_1_1systems_1_1_leaf_system.html" title="A superclass template that extends System with some convenience utilities that are not applicable to ...">LeafSystem</a> for declaring various trigger and event update combinations; see, e.g., <a class="el" href="classdrake_1_1systems_1_1_leaf_system.html#ad7786537a2832acd0d4f0d80827c1291" title="Declares that a Publish event should occur periodically and that it should invoke the given event han...">LeafSystem::DeclarePeriodicPublishEvent()</a>, <a class="el" href="classdrake_1_1systems_1_1_leaf_system.html#a045f31a25ecb0c57baede1abd70182a8" title="Declares that a DiscreteUpdate event should occur at the start of every trajectory-advancing step and...">LeafSystem::DeclarePerStepDiscreteUpdateEvent()</a>, and <a class="el" href="classdrake_1_1systems_1_1_leaf_system.html#ae04f150e6036b0cbbf9808cc0f71a9a6" title="Declares that an UnrestrictedUpdate event should occur at initialization and that it should invoke th...">LeafSystem::DeclareInitializationUnrestrictedUpdateEvent()</a>.</p>
<p>The following sample code shows how to declare a publish event that is triggered at regular time intervals: </p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div><div class="line"><span class="keyword">class </span>MySystem : <span class="keyword">public</span> LeafSystem&lt;T&gt; {</div><div class="line"> MySystem() {</div><div class="line">   <span class="keyword">const</span> <span class="keywordtype">double</span> period = 1.0;</div><div class="line">   <span class="keyword">const</span> <span class="keywordtype">double</span> offset = 0.0;</div><div class="line">   this-&gt;DeclarePeriodicPublishEvent(period, offset, &amp;MySystem::MyPublish);</div><div class="line"> }</div><div class="line"></div><div class="line"> <span class="comment">// Called once per second when MySystem is simulated.</span></div><div class="line"> EventStatus MyPublish(<span class="keyword">const</span> Context&lt;T&gt;&amp;)<span class="keyword"> const </span>{ ... }</div><div class="line">};</div></div><!-- fragment --><h4>Trigger data carried with Events</h4>
<p>It can be impractical or infeasible to create a different handler function for every possible trigger that a leaf system might need to consider. The alternative is to create a single event handler and map multiple triggers to it via multiple Event objects that specify the same handler. Then the handler may need a way to determine which condition triggered it.</p>
<p>For this purpose, every Event stores the type of trigger associated with it and, if relevant, some extra data that provides greater insight into why the event handler was invoked. The latter is stored in an <code>std::variant</code> field that is currently defined for periodic-triggered timing information and for witness-triggered localization information. For example: </p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div><div class="line"><span class="keyword">class </span>MySystem : <span class="keyword">public</span> LeafSystem&lt;T&gt; {</div><div class="line"> MySystem() {</div><div class="line">   <span class="keyword">const</span> <span class="keywordtype">double</span> period1 = 1.0;</div><div class="line">   <span class="keyword">const</span> <span class="keywordtype">double</span> period2 = 2.0;</div><div class="line">   <span class="keyword">const</span> <span class="keywordtype">double</span> offset = 0.0;</div><div class="line"></div><div class="line">   <span class="comment">// Declare a publish event with one period.</span></div><div class="line">   this-&gt;DeclarePeriodicEvent(period1, offset, PublishEvent&lt;T&gt;(</div><div class="line">       <a class="code" href="namespacedrake_1_1systems.html#a59b7f49353f2a99b6c22d2eaae0fe9e9aa4dadcf41a1fb6841557aad7688dc1a4">TriggerType::kPeriodic</a>,</div><div class="line">       [<span class="keyword">this</span>](<span class="keyword">const</span> Context&lt;T&gt;&amp; context, <span class="keyword">const</span> PublishEvent&lt;T&gt;&amp; event) -&gt;</div><div class="line">           EventStatus {</div><div class="line">         <span class="keywordflow">return</span> MyPublish(context, event);</div><div class="line">       }));</div><div class="line"></div><div class="line">   <span class="comment">// Declare a second publish event with another period.</span></div><div class="line">   this-&gt;DeclarePeriodicEvent(period2, offset, PublishEvent&lt;T&gt;(</div><div class="line">       <a class="code" href="namespacedrake_1_1systems.html#a59b7f49353f2a99b6c22d2eaae0fe9e9aa4dadcf41a1fb6841557aad7688dc1a4">TriggerType::kPeriodic</a>,</div><div class="line">       [<span class="keyword">this</span>](<span class="keyword">const</span> Context&lt;T&gt;&amp; context, <span class="keyword">const</span> PublishEvent&lt;T&gt;&amp; event) -&gt;</div><div class="line">           EventStatus {</div><div class="line">         <span class="keywordflow">return</span> MyPublish(context, event);</div><div class="line">       }));</div><div class="line"> }</div><div class="line"></div><div class="line"> <span class="comment">// A single update handler for all triggered events.</span></div><div class="line"> EventStatus MyPublish(<span class="keyword">const</span> Context&lt;T&gt;&amp;, <span class="keyword">const</span> PublishEvent&lt;T&gt;&amp; e)<span class="keyword"> const </span>{</div><div class="line">   <span class="keywordflow">if</span> (e.get_trigger_type() == <a class="code" href="namespacedrake_1_1systems.html#a59b7f49353f2a99b6c22d2eaae0fe9e9aa4dadcf41a1fb6841557aad7688dc1a4">TriggerType::kPeriodic</a>) {</div><div class="line">     std::cout &lt;&lt; <span class="stringliteral">&quot;Event period: &quot;</span></div><div class="line">         &lt;&lt; e.template get_event_data&lt;PeriodicEventData&gt;()-&gt;period_sec()</div><div class="line">         &lt;&lt; std::endl;</div><div class="line">   }</div><div class="line"> }</div><div class="line">};</div></div><!-- fragment --> <dl class="section see"><dt>See also</dt><dd><a class="el" href="classdrake_1_1systems_1_1_periodic_event_data.html" title="An event data variant describing an event that recurs on a fixed period.">PeriodicEventData</a>, <a class="el" href="classdrake_1_1systems_1_1_witness_triggered_event_data.html" title="An event data variant for storing data from a witness function triggering to be passed to event handl...">WitnessTriggeredEventData</a></dd></dl>
<h4>Event status</h4>
<p>Event handlers can return an <a class="el" href="classdrake_1_1systems_1_1_event_status.html" title="Holds the return status from execution of an event handler function, or the effective status after a ...">EventStatus</a> type to modulate the behavior of a solver. Returning <a class="el" href="classdrake_1_1systems_1_1_event_status.html#a11717da96dc4e4a5f79371318448f82ba48ee4661a1d96abae7dda31fbcaec970" title="Handler was unable to perform its job (has message).">EventStatus::kFailed</a> from the event handler indicates that the event handler was unable to update the state (because, e.g., the simulation step was too big) and thus the solver should take corrective action. Or an event handler can return <a class="el" href="classdrake_1_1systems_1_1_event_status.html#a11717da96dc4e4a5f79371318448f82ba76d2ce0414adfab1eb799c27b3965197" title="Handler succeeded but detected a termination condition (has message).">EventStatus::kReachedTermination</a> to indicate that the solver should stop computing; this is useful if the event handler detects that a simulated walking robot has fallen over and that the end of a reinforcement learning episode has been observed, for example.</p>
<h3>Glossary</h3>
<p><a class="anchor" id="event_glossary"></a></p><ul>
<li><b>dispatch</b>: the process of the solver collecting events that trigger simultaneously and then distributing those events to their handlers.</li>
<li><b>forced event</b>: when an event is triggered manually through user code rather than by a solver.</li>
<li><b>handle/handler</b>: an event is "handled" when the triggering condition has been identified and the "handler" function is called.</li>
<li><b>solver</b>: a process that controls or tracks the time and state evolution of a <a class="el" href="classdrake_1_1systems_1_1_system.html" title="Base class for all System functionality that is dependent on the templatized scalar type T for input,...">System</a>.</li>
<li><b>trigger</b>: the condition responsible for causing an event. </li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- footer -->
<div id="nav-path" class="navpath">
  <ul>
  </ul>
</div>
<footer class="site-footer padding">
  <div class="contain">
    <a href="/" class="drake-logo">
      <img src="/images/drake-logo.svg"/>
    </a>
    <div class="footer-menu">
      <ul>    
        <li>
          <a href="/doxygen_cxx/index.html" class="site-menu-item">C++</a>
        </li>    
        <li>
          <a href="/pydrake/index.html" class="site-menu-item">Python</a>
        </li>
        <li class="github-link">
          <a href="https://github.com/RobotLocomotion/drake" class="site-menu-item">GitHub <img src="/third_party/images/GitHub-Mark-64px.png"/></a>
        </li>
      </ul>
    </div>
  </div>
</footer>
<script type="text/javascript">
searchBox.searchLabel = 'Go to name…';
searchBox.DOMSearchField().value = searchBox.searchLabel;
</script>
</body>
</html>
