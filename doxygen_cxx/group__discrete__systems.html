<!-- HTML header for doxygen 1.14.0-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Drake: Discrete Systems</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(function() { init_search(); });
</script>
<script type="text/javascript">
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  }
};
</script>
<script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_extra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<header class="site-header">
 <div class="site-header-inner contain">
  <a class="drake-logo" href="/"><img src="/images/drake-logo-white.svg"></a>
  <div class="menu-mobile-toggle">
   <span></span>
  </div>
  <nav class="site-menu">
   <ul>
    <li class="site-menu-item site-menu-item-main">
     <a class="site-menu-item" href="/">Home</a>
    </li>
    <li class="site-menu-item site-menu-item-main">
     <a class="site-menu-item" href="/installation.html">Installation</a>
    </li>
    <li class="site-menu-item site-menu-item-main">
     <a class="site-menu-item" href="/gallery.html">Gallery</a>
    </li>
    <li class="site-menu-item site-menu-item-main">API Documentation
     <div class="sub">
      <a class="site-menu-item" href="/doxygen_cxx/index.html">C++</a>
      <a class="site-menu-item" href="/pydrake/index.html">Python</a>
     </div>
    </li>
    <li class="site-menu-item site-menu-item-main">Resources
     <div class="sub">
      <a class="site-menu-item" href="/getting_help.html">Getting Help</a>
      <a class="site-menu-item" href="https://deepnote.com/workspace/Drake-0b3b2c53-a7ad-441b-80f8-bf8350752305/project/Tutorials-2b4fc509-aef2-417d-a40d-6071dfed9199/notebook/index-753e3c9d261247ba9f0eb1d7868c18c8">Tutorials</a>
      <a class="site-menu-item" href="/python_bindings.html">Python Bindings</a>
      <a class="site-menu-item" href="/developers.html">For Developers</a>
      <a class="site-menu-item" href="/credits.html">Credits</a>
     </div>
    </li>
    <li class="github-link">
     <a class="site-menu-item" href="https://github.com/RobotLocomotion/drake">GitHub <img src="/third_party/images/GitHub-Mark-Light-64px.png"></a>
    </li>
   </ul>
  </nav>
 </div>
</header>
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Drake
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<div class="title-banner">
 <div class="title-banner__title">
  Drake C++ Documentation
 </div>
 <div id="DDGSearch">
  <form id="search_form_cpp" class="wy_form" action="https://google.com/search" method="get">
   <input type="text" name="q" placeholder="Search C++ API only…">
   <input type="hidden" name="q" value="site:drake.mit.edu/doxygen_cxx">
  </form>
  <form id="search_form" class="wy_form" action="https://google.com/search" method="get">
   <input type="text" name="q" placeholder="Search all of Drake…">
   <input type="hidden" name="q" value="site:drake.mit.edu OR site:underactuated.csail.mit.edu OR site:manipulation.csail.mit.edu">
  </form>
 </div>
 <div id="MSearchBoxContainer">
  <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect" class="search-icon" onmouseover="return searchBox.OnSearchSelectShow()" onmouseout="return searchBox.OnSearchSelectHide()"><span class="search-icon-dropdown"></span></span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><div id="MSearchCloseImg" class="close-icon"></div></a>
          </span>
        </div>
</td>
 </div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('group__discrete__systems.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">Discrete Systems <div class="ingroups"><a class="el" href="group__systems.html">Modeling Dynamical Systems</a></div></div></div>
</div><!--header-->
<div class="contents">
<p>This page describes discrete systems modeled by difference equations (contrast to continuous systems modeled by ordinary differential equations) as well as considerations for implementing these systems in Drake. </p>
<p>The state space dynamics of a discrete system is: </p><div class="fragment"><div class="line">x_{n+1} = f(n, x_n, u_n)    <span class="comment">// update</span></div>
<div class="line">y_n     = g(n, x_n, u_n)    <span class="comment">// output</span></div>
<div class="line">x_0     = x_init            <span class="comment">// initialize</span></div>
</div><!-- fragment --><p> (We're using LaTeX underscore notation for subscripts, where x_0 means x₀.)</p>
<p>Here n ∈ ℕ is the step number (typically starting at zero), x is the discrete-time state variable ("discrete time" refers to the countability of the elements of the sequence, x_0, x_1, ..., x_n and not the values that x can take), y is the desired output, and u is an external input. f(.) and g(.) are the <em>update</em> and <em>output</em> functions, respectively. Any of these quantities can be vector-valued. The subscript notation (e.g., x_0) is used to show that the state, input, and output result from a discrete process. We use square bracket notation, e.g. x[1] to designate particular elements of a vector-valued quantity (indexing from 0). Combined, x_1[3] would be the value of the fourth element of the x vector, evaluated at step n=1.</p>
<h3>A pedagogical example: simple difference equation</h3>
<p>The following class implements in Drake the simple discrete system </p><div class="fragment"><div class="line">x_{n+1} = x_n + 1</div>
<div class="line">y_n     = 10 x_n</div>
<div class="line">x_0     = 0</div>
</div><!-- fragment --><p> which should generate the sequence <span class="tt">S = 0 10 20 30 ...</span> (that is, <span class="tt">S_n = 10*n</span>).</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>ExampleDiscreteSystem : <span class="keyword">public</span> LeafSystem&lt;double&gt; {</div>
<div class="line"> <span class="keyword">public</span>:</div>
<div class="line">  <a class="code hl_define" href="drake__copyable_8h.html#a3ee22789c29a46dddd6a7fd2b982731c">DRAKE_NO_COPY_NO_MOVE_NO_ASSIGN</a>(ExampleDiscreteSystem);</div>
<div class="line"> </div>
<div class="line">  ExampleDiscreteSystem() {</div>
<div class="line">    DeclareDiscreteState(1);  <span class="comment">// Just one state variable, x[0], default=0.</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Update to x_{n+1}, using a Drake &quot;discrete update&quot; event (occurs</span></div>
<div class="line">    <span class="comment">// at the beginning of step n+1).</span></div>
<div class="line">    DeclarePeriodicDiscreteUpdateEvent(kPeriod, kOffset,</div>
<div class="line">                                       &amp;ExampleDiscreteSystem::Update);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Present y_n (=S_n) at the output port.</span></div>
<div class="line">    DeclareVectorOutputPort(<span class="stringliteral">&quot;Sn&quot;</span>, 1, &amp;ExampleDiscreteSystem::Output);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keywordtype">double</span> kPeriod = 1 / 50.;  <span class="comment">// Update at 50Hz (h=1/50).</span></div>
<div class="line">  <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keywordtype">double</span> kOffset = 0.;       <span class="comment">// Trigger events at n=0.</span></div>
<div class="line"> </div>
<div class="line"> <span class="keyword">private</span>:</div>
<div class="line">  <span class="keywordtype">void</span> Update(<span class="keyword">const</span> systems::Context&lt;double&gt;&amp; context,</div>
<div class="line">              systems::DiscreteValues&lt;double&gt;* xd)<span class="keyword"> const </span>{</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> x_n = context.get_discrete_state()[0];</div>
<div class="line">    (*xd)[0] = x_n + 1.;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> Output(<span class="keyword">const</span> systems::Context&lt;double&gt;&amp; context,</div>
<div class="line">              systems::BasicVector&lt;double&gt;* result)<span class="keyword"> const </span>{</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> x_n = context.get_discrete_state()[0];</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> S_n = 10 * x_n;</div>
<div class="line">    (*result)[0] = S_n;</div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="ttc" id="adrake__copyable_8h_html_a3ee22789c29a46dddd6a7fd2b982731c"><div class="ttname"><a href="drake__copyable_8h.html#a3ee22789c29a46dddd6a7fd2b982731c">DRAKE_NO_COPY_NO_MOVE_NO_ASSIGN</a></div><div class="ttdeci">#define DRAKE_NO_COPY_NO_MOVE_NO_ASSIGN(Classname)</div><div class="ttdoc">DRAKE_NO_COPY_NO_MOVE_NO_ASSIGN deletes the special member functions for copy-construction,...</div><div class="ttdef"><b>Definition</b> drake_copyable.h:31</div></div>
</div><!-- fragment --><p>The following code fragment can be used to step this system forward: </p><div class="fragment"><div class="line"><span class="comment">// Build a Diagram containing the Example system and a data logger that</span></div>
<div class="line"><span class="comment">// samples the Sn output port exactly at the update times.</span></div>
<div class="line">DiagramBuilder&lt;double&gt; builder;</div>
<div class="line"><span class="keyword">auto</span> example = builder.AddSystem&lt;ExampleDiscreteSystem&gt;();</div>
<div class="line"><span class="keyword">auto</span> logger = <a class="code hl_function" href="namespacedrake_1_1systems.html#a7ff25bee1ef9f902b1102792f6ff3eb2">LogVectorOutput</a>(example-&gt;GetOutputPort(<span class="stringliteral">&quot;Sn&quot;</span>), &amp;builder,</div>
<div class="line">                              ExampleDiscreteSystem::kPeriod);</div>
<div class="line"><span class="keyword">auto</span> diagram = builder.Build();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create a Simulator and use it to advance time until t=3*h.</span></div>
<div class="line">Simulator&lt;double&gt; simulator(*diagram);</div>
<div class="line">simulator.AdvanceTo(3 * ExampleDiscreteSystem::kPeriod);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Print out the contents of the log.</span></div>
<div class="line"><span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code hl_function" href="namespacedrake.html#aa157c1d75c2e52df3370e5f458022ee9">log</a> = logger.FindLog(simulator.get_context());</div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = 0; n &lt; <a class="code hl_function" href="namespacedrake.html#aa157c1d75c2e52df3370e5f458022ee9">log</a>.sample_times().size(); ++n) {</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> t = <a class="code hl_function" href="namespacedrake.html#aa157c1d75c2e52df3370e5f458022ee9">log</a>.sample_times()[n];</div>
<div class="line">  std::cout &lt;&lt; n &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; <a class="code hl_function" href="namespacedrake.html#aa157c1d75c2e52df3370e5f458022ee9">log</a>.data()(0, n)</div>
<div class="line">      &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; t &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;</div>
<div class="line">}</div>
<div class="ttc" id="anamespacedrake_1_1systems_html_a7ff25bee1ef9f902b1102792f6ff3eb2"><div class="ttname"><a href="namespacedrake_1_1systems.html#a7ff25bee1ef9f902b1102792f6ff3eb2">drake::systems::LogVectorOutput</a></div><div class="ttdeci">VectorLogSink&lt; T &gt; * LogVectorOutput(const OutputPort&lt; T &gt; &amp;src, DiagramBuilder&lt; T &gt; *builder, double publish_period=0.0)</div><div class="ttdoc">LogVectorOutput provides a convenience function for adding a VectorLogSink, initialized to the correc...</div><div class="ttdef"><b>Definition</b> vector_log_sink.h:148</div></div>
<div class="ttc" id="anamespacedrake_html_aa157c1d75c2e52df3370e5f458022ee9"><div class="ttname"><a href="namespacedrake.html#aa157c1d75c2e52df3370e5f458022ee9">drake::log</a></div><div class="ttdeci">logging::logger * log()</div><div class="ttdoc">Retrieve an instance of a logger to use for logging; for example:</div></div>
</div><!-- fragment --><p> The above yields the following output: </p><div class="fragment"><div class="line">0: 0 (0)</div>
<div class="line">1: 10 (0.02)</div>
<div class="line">2: 20 (0.04)</div>
<div class="line">3: 30 (0.06)</div>
</div><!-- fragment --><h3>Modeling discrete systems in Drake's hybrid systems framework</h3>
<p>Purely-discrete systems produce values only intermittently. For example, the system above generates values only at integer values of n: </p><pre>

     y_n
      |
   30 |              ●
      |              ┆             Figure 1. The discrete-valued system
   20 |         ●    ┆             from the example above.
      |         ┆    ┆
   10 |    ●    ┆    ┆
      |    ┆    ┆    ┆
    0 ●----+----+----+--
      0    1    2    3   n
      +----+----+----+--
      0   .02  .04  .06  t
</pre><p>Drake's simulator is for hybrid systems, that is, systems that advance through <em>time</em>, and evolve in time both continuously (flow) and discretely (jump). It is easy enough to use time to represent the discrete steps n, by the conversion <span class="tt">t=n*h</span> where h is a periodic sampling time. In Figure 1 we've shown the conversion to time used by the example above as a second horizontal axis, assuming h=0.02 seconds.</p>
<p>However, since Drake simulations advance through <em>continuous</em> time, it must be possible to obtain the values of all state variables and outputs at <em>any</em> time t, not just at discrete times. So the question arises: what is the value of y(t) for values of t in between the sample times shown above? The answer doesn't matter for the example above, but becomes significant when we mix continuous and discrete systems, since they are typically interdependent.</p>
<p>Sample-and-hold is the most common way to go from a discrete value to a continuous one. There are two equally-plausible ways to use sample-and-hold to fill in the gaps between the discrete sample times above, shown in Figure 2: </p><pre>

      y(t)             ●━                    y(t)
        |              ┆                       |
     30 |         ●━━━━○                    30 |              ●━
        |         ┆                            |              ┆
     20 |    ●━━━━○                         20 |         ●━━━━○
        |    ┆                                 |         ┆
     10 ●━━━━○                              10 |    ●━━━━○
        ┆                                      |    ┆
      0 ○----+----+----+-- t                 0 ●━━━━○----+----+-- t
        0   .02  .04  .06                      0   .02  .04  .06

   (a) Sample at start of step.           (b) Sample at end of step.
       (Drake uses this method.)              (Not used in Drake.)

          Figure 2: two ways to make a continuous function from
          a discrete one, using sample-and-hold.
</pre><p> In the figure, the ○ markers show the function value at time t <em>before</em> the update function is invoked, while the ● markers show the value <em>after</em> the update. In (a), the ○ markers coincide with the original discrete values, while in (b), the ● markers do.</p>
<p>You might expect that 2(b) would be the most natural mapping from the discrete system to a continuous one. In practice, however, it is problematic for mixed discrete/continuous (hybrid) systems so Drake uses the mapping in 2(a). The advantage of 2(a) is that the hybrid update function <span class="tt">x_{n+1} = f(t,n,x_n,u(t))</span> is invoked at time <span class="tt">t=n*h</span>, while in 2(b) it would be invoked at time <span class="tt">t=(n+1)*h</span>. That would make it difficult to coordinate discrete and continuous signals.</p>
<p>Drake's choice of 2(a) dictates what value a discrete quantity will have when evaluated at times <em>between</em> update times. In particular, consider a discrete variable x evaluated during a simulation from a publish, update, or derivative function at times <span class="tt">t ∈ (n*h, (n+1)*h]</span>. x will be seen to have value <span class="tt"><a class="el" href="light__parameter_8h.html#a9336ebf25087d91c818ee6e9ec29f8c1">x(t)</a> = x_{n+1}</span> (<em>not</em> <span class="tt">x_n</span>). You can see that clearly by inspection of Figure 2(a).</p>
<h3>Timing of publish vs. discrete update events in Drake</h3>
<p>A discrete system viewed in continuous time does not have a unique value at its sample times. In Figure 2, each pair of ○ and ● symbols shows two possible values at the same time. For a given sample time t, we use the notation x⁻(t) to denote the "pre-update" value of the state x, and x⁺(t) to denote the "post-update" value of x. So x⁻(t) is the value of x at time t <em>before</em> discrete variables are updated, and x⁺(t) the value of x at time t <em>after</em> they are updated. Thus if we have <span class="tt">t = n*h</span> as in the discussion above, then <span class="tt">x⁻(t) = x_n</span> and <span class="tt">x⁺(t) = x_{n+1}</span>. State-dependent computations are affected by the scheduling of these updates. For example, evaluating an input u(t) yields u⁻(t) before discrete updates, and u⁺(t) afterwards, meaning that the input evaluation is carried out using x⁻(t) or x⁺(t), respectively.</p>
<p>With those distinctions drawn, we can define Drake's state update behavior during a time step:</p><ul>
<li><span class="tt">Publish</span> events at time t see x⁻(t), so if a publish event handler evaluates an input it sees u⁻(t). This occurs at the end of a step, shown as ○ markers in Figure 2.</li>
<li><span class="tt">Update</span> events (of all kinds) at time t also see x⁻(t) and u⁻(t), and produce x⁺(t). This occurs at the start of the next step, shown as ● markers in Figure 2.</li>
<li><span class="tt">Continuous</span> update (numerical integration and time advancement) starts with x⁺(t). Input and derivative evaluations will occur repeatedly as the time and continuous state advance. Each evaluation will be performed using updated values for continuous states xc and time. However, the discrete variables (state partitions xd and xa) are held constant at their x⁺(t) values, that is, at xd⁺(t) and xa⁺(t).</li>
</ul>
<p>If you define periodic events starting at t=0 as we did in the example above, the first publish event occurs at the end of initialization, while the first discrete update event occurs at the beginning of the first step, followed by continuous time and state advancement.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="classdrake_1_1systems_1_1_simulator.html" title="A class for advancing the state of hybrid dynamic systems, represented by System&lt;T&gt; objects,...">drake::systems::Simulator</a> for more details. </dd></dl>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- footer -->
<div class="navpath">
  <ul>
  </ul>
</div>
<footer id="nav-path", class="site-footer padding">
  <div class="contain">
    <a href="/" class="drake-logo">
      <img src="/images/drake-logo.svg"/>
    </a>
    <div class="footer-menu">
      <ul>    
        <li>
          <a href="/doxygen_cxx/index.html" class="site-menu-item">C++</a>
        </li>    
        <li>
          <a href="/pydrake/index.html" class="site-menu-item">Python</a>
        </li>
        <li class="github-link">
          <a href="https://github.com/RobotLocomotion/drake" class="site-menu-item">GitHub <img src="/third_party/images/GitHub-Mark-64px.png"/></a>
        </li>
      </ul>
    </div>
  </div>
</footer>
<script type="text/javascript">
searchBox.searchLabel = 'Go to name…';
searchBox.DOMSearchField().placeholder = searchBox.searchLabel;
searchBox.DOMSearchField().value = '';
</script>
</body>
</html>
